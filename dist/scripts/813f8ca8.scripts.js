var ctor=function(){var a,b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i=this;return c="undefined"!=typeof exports&&null!==exports?new Object:this,c.KiiSocialNetworkName={FACEBOOK:1,TWITTER:2},c.KiiSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api"},c.Kii=function(){function b(){}var e;return e=null,b.getBuildNumber=function(){return"1"},b.getSDKVersion=function(){return"2.1.11"},b.getBaseURL=function(){return e._baseURL},b.getAppID=function(){return e._appID},b.getAppKey=function(){return e._appKey},b.isLogging=function(){return e._logging},b.setLogging=function(a){return c.Kii.logger("Setting logging: "+a),e._logging=a},b.initializeWithSite=function(a,b,f){return null==e&&(e=new d(a,b,f)),c.Kii.logger("Initialized "+a+", "+b+", "+f)},b.initialize=function(a,b){return c.Kii.initializeWithSite(a,b,c.KiiSite.US)},b.error=function(a){return console.log("KiiSDK Error => "+a)},b.logger=function(a){return e._logging?console.log(a):void 0},b.bucketWithName=function(a){return new c.KiiBucket._bucketWithName(a,null)},b.groupWithName=function(a){return new c.Kii.groupWithNameAndMembers(a,null)},b.groupWithNameAndMembers=function(a,b){return new c.KiiGroup.groupWithNameAndMembers(a,b)},b.logOut=function(){return e._currentUser=null,c.KiiSocialConnect.logOutAll()},b.loggedIn=function(){return null!=e._currentUser},b.getCurrentUser=function(){var a;return null!=e._currentUser?(a=new c.KiiUser,a._uuid=e._currentUser._uuid,a._username=e._currentUser._username,a._displayName=e._currentUser._displayName,a._password=e._currentUser._password,a._emailAddress=e._currentUser._emailAddress,a._phoneNumber=e._currentUser._phoneNumber,a._country=e._currentUser._country,a._created=e._currentUser._created,a._modified=e._currentUser._modified,a._emailVerified=e._currentUser._emailVerified,a._phoneVerified=e._currentUser._phoneVerified,a._accessToken=e._currentUser._accessToken,a._customInfo=e._currentUser._customInfo,c.Kii.logger("my instance:"),c.Kii.logger(a),a):null},b.setCurrentUser=function(a){return e._currentUser=new c.KiiUser,e._currentUser._uuid=a._uuid,e._currentUser._username=a._username,e._currentUser._displayName=a._displayName,e._currentUser._password=a._password,e._currentUser._emailAddress=a._emailAddress,e._currentUser._phoneNumber=a._phoneNumber,e._currentUser._country=a._country,e._currentUser._created=a._created,e._currentUser._modified=a._modified,e._currentUser._emailVerified=a._emailVerified,e._currentUser._phoneVerified=a._phoneVerified,e._currentUser._accessToken=a._accessToken,e._currentUser._customInfo=a._customInfo,c.Kii.logger("my instance:"),c.Kii.logger(e._currentUser)},b.authenticateAsAppAdmin=function(b,d,e){var f,g;return g=new a("/oauth2/token",!1),g.setAnonymous(!0),g.setMethod("POST"),g.setData({client_id:b,client_secret:d}),f={success:function(a){var b,d,f;return f=a.access_token,d=a.id,c.Kii.logger("token: "+f),c.Kii.logger("id: "+d),b=new c.KiiAppAdminContext({token:f,id:d}),null!=e?e.success(b):void 0},failure:function(a,b){return c.Kii.logger("error: "+a),c.Kii.logger("statusCode: "+b),null!=e?e.failure(a,b):void 0}},g.execute(f,!1)},b}(),d=function(){function a(a,b,c){console.log("Setting site: "+c),this._appKey=b,this._appID=a,this._baseURL=c}return a.prototype._logging=!1,a.prototype._baseURL=null,a.prototype._currentUser=null,a}(),c.KiiACL=function(){function d(){this._userWithID=f(this._userWithID,this),this._groupWithID=f(this._groupWithID,this),this._getRequest=f(this._getRequest,this),this._saveItr=f(this._saveItr,this),this.save=f(this.save,this),this.removeACLEntry=f(this.removeACLEntry,this),this.putACLEntry=f(this.putACLEntry,this),this.listACLEntries=f(this.listACLEntries,this),this.aclPath=f(this.aclPath,this),this._setParent=f(this._setParent,this),this._entries=[]}var e,g,h;return h=null,e=null,g=null,d.prototype._setParent=function(a){this._parent=a},d.prototype.aclPath=function(){var a,b,d,e,f,g,h;return this._parent instanceof c.KiiObject?(e=this._parent,null!=e.getBucket().getUser()?h=e.getBucket().getUser():null!=e.getBucket().getGroup()&&(d=e.getBucket().getGroup()),b=e.getBucket().getBucketName(),f=e.getUUID()):this._parent instanceof c.KiiBucket?(a=this._parent,null!=a.getUser()?h=a.getUser():null!=a.getGroup()&&(d=a.getGroup()),b=a.getBucketName()):c.Kii.error("Invalid ACL parent. Must belong to a KiiObject"),g="/",null!=d?g+="groups/"+d.getUUID()+"/":null!=h&&(g+="users/"+h.getUUID()+"/"),g+=null!=f?"buckets/"+b+"/objects/"+f+"/acl":"buckets/"+b+"/acl"},d.prototype.listACLEntries=function(a){var b,d,e=this;return h=this,c.Kii.logger("Listing ACL entries"),d=this._getRequest({path:this.aclPath(),withApp:!0}),b={success:function(b,d){var f,g,i,j,k,l,m,n;if(300>d&&d>=200){j=[];for(i in b)for(l=b[i],"WRITE_EXISTING_OBJECT"===i?f=c.KiiACLAction.KiiACLObjectActionWrite:"READ_EXISTING_OBJECT"===i?f=c.KiiACLAction.KiiACLObjectActionRead:"QUERY_OBJECTS_IN_BUCKET"===i?f=c.KiiACLAction.KiiACLBucketActionQueryObjects:"CREATE_OBJECTS_IN_BUCKET"===i?f=c.KiiACLAction.KiiACLBucketActionCreateObjects:"DROP_BUCKET_WITH_ALL_CONTENT"===i&&(f=c.KiiACLAction.KiiACLBucketActionDropBucket),m=0,n=l.length;n>m;m++)g=l[m],null!=g.groupID?k=e._groupWithID(g.groupID):null!=g.userID&&(k=e._userWithID(g.userID)),j.push(KiiACLEntry.entryWithSubject(k,f));return a.success(h,j)}return a.failure(h,"Unable to retrieve ACL list")},failure:function(b){return a.failure(h,b)}},d.execute(b,!1)},d.prototype.putACLEntry=function(a){return-1===$.inArray(a,this._entries)?this._entries.push(a):void 0},d.prototype.removeACLEntry=function(a){var c;return c=$.inArray(a,this._entries),c>-1?b.arrayRemove(this._entries,c,c):void 0},d.prototype.save=function(a){return c.Kii.logger("SAving acl"),this._saveItr(0,a)},d.prototype._saveItr=function(a,b){var d,e,f,g,h=this;return h=this,d=this._entries[a],e=""+this.aclPath()+"/"+d.getActionString()+"/"+d.getEntityString(),c.Kii.logger("Saving single @path: "+e),f=this._getRequest({path:e,withApp:!0}),f.setMethod(d.getGrant()===!0?"PUT":"DELETE"),g=null,f.execute({success:function(){return a<h._entries.length-1?h._saveItr(a+1,b):b.success(h)},failure:function(a){return b.failure(h,a)}},!1)},d.aclWithParent=function(a){var b;return b=new c.KiiACL,b._setParent(a),b},d.prototype._getRequest=function(b){var c,d,e;return c=b.path,e=b.withApp,d=new a(c,e)},d.prototype._groupWithID=function(a){var b;return b=c.KiiGroup._groupWithID(a)},d.prototype._userWithID=function(a){var b;return b=c.KiiUser._userWithID(a)},d}.call(this),c.KiiACLAction={KiiACLBucketActionCreateObjects:0,KiiACLBucketActionQueryObjects:1,KiiACLBucketActionDropBucket:2,KiiACLObjectActionRead:3,KiiACLObjectActionWrite:4},c.KiiACLEntry=function(){function a(){this.getEntityString=f(this.getEntityString,this),this.getActionString=f(this.getActionString,this),this.getGrant=f(this.getGrant,this),this.setGrant=f(this.setGrant,this),this.getSubject=f(this.getSubject,this),this.setSubject=f(this.setSubject,this),this.getAction=f(this.getAction,this),this.setAction=f(this.setAction,this),this._action=-1,this._grant=!0}var b,d,e;return b=null,e=null,d=null,a.prototype.setAction=function(a){if(a>=c.KiiACLAction.KiiACLBucketActionCreateObjects&&a<=c.KiiACLAction.KiiACLObjectActionWrite)return this._action=a;throw new InvalidACLAction},a.prototype.getAction=function(){return this._action},a.prototype.setSubject=function(a){if(a instanceof c.KiiGroup||a instanceof c.KiiUser||a instanceof c.KiiAnyAuthenticatedUser||a instanceof c.KiiAnonymousUser)return this._subject=a;throw new InvalidACLSubject},a.prototype.getSubject=function(){return this._subject},a.prototype.setGrant=function(a){if(a===!0||a===!1)return this._grant=a;throw new InvalidACLGrant},a.prototype.getGrant=function(){return this._grant},a.entryWithSubject=function(a,b){var d;return c.Kii.logger("EWS: "+a+", "+b),d=new c.KiiACLEntry,d.setSubject(a),d.setAction(b),d},a.prototype.getActionString=function(){var a;switch(c.Kii.logger("Action: "+this.action),this._action){case c.KiiACLAction.KiiACLBucketActionCreateObjects:a="CREATE_OBJECTS_IN_BUCKET";break;case c.KiiACLAction.KiiACLBucketActionQueryObjects:a="QUERY_OBJECTS_IN_BUCKET";break;case c.KiiACLAction.KiiACLBucketActionDropBucket:a="DROP_BUCKET_WITH_ALL_CONTENT";break;case c.KiiACLAction.KiiACLObjectActionRead:a="READ_EXISTING_OBJECT";break;case c.KiiACLAction.KiiACLObjectActionWrite:a="WRITE_EXISTING_OBJECT";break;default:return a}return a},a.prototype.getEntityString=function(){var a,b;return this._subject instanceof c.KiiGroup?(a=this._subject.getUUID(),b="GroupID"):this._subject instanceof c.KiiUser?(a=this._subject.getUUID(),b="UserID"):this._subject instanceof c.KiiAnyAuthenticatedUser?(b="UserID",a="ANY_AUTHENTICATED_USER"):this._subject instanceof c.KiiAnonymousUser&&(b="UserID",a="ANONYMOUS_USER"),""+b+":"+a},a}.call(this),c.KiiBucket=function(){function b(a,b){this.objectWithJSON=f(this.objectWithJSON,this),this._generatePath=f(this._generatePath,this),this._getRequest=f(this._getRequest,this),this["delete"]=f(this["delete"],this),this.executeQuery=f(this.executeQuery,this),this.acl=f(this.acl,this),this.createObjectWithType=f(this.createObjectWithType,this),this.createObject=f(this.createObject,this),this._setBucketName=f(this._setBucketName,this),this.getBucketName=f(this.getBucketName,this),this._setGroup=f(this._setGroup,this),this.getGroup=f(this.getGroup,this),this._setUser=f(this._setUser,this),this.getUser=f(this.getUser,this),this._bucketName=a,null!=b&&(b instanceof c.KiiGroup?this._group=b:b instanceof c.KiiUser&&(this._user=b))}var d,e,g,h;return b.prototype._className="KiiBucket",g=null,d=null,h=null,e=null,b.prototype.getUser=function(){return this._user},b.prototype._setUser=function(a){this._user=a},b.prototype.getGroup=function(){return this._group},b.prototype._setGroup=function(a){this._group=a},b.prototype.getBucketName=function(){return this._bucketName},b.prototype._setBucketName=function(a){this._bucketName=a},b.prototype.createObject=function(){return c.KiiObject.objectWithBucket(this,null)},b.prototype.createObjectWithType=function(a){return c.KiiObject.objectWithBucket(this,a)},b.prototype.acl=function(){return c.KiiACL.aclWithParent(this)},b.prototype.executeQuery=function(a,b){var d,e,f,h,i;return g=this,h=this._generatePath()+"/query",e={},null!=a?(d=a._dictValue(),e.bestEffortLimit=a.getLimit(),null!=a.getPaginationKey()&&(e.paginationKey=a.getPaginationKey())):d={clause:c.KiiQuery._emptyDictValue()},i=this._getRequest({path:h,withApp:!0}),i.setMethod("POST"),i.setContentType("application/vnd.kii.QueryRequest+json"),e.bucketQuery=d,i.setData(e),f={success:function(c,d){var e,f,h,i,j,k;if(300>d&&d>=200){for(h=[],k=c.results,i=0,j=k.length;j>i;i++)f=k[i],h.push(g.objectWithJSON(f));if(null!=c.nextPaginationKey&&(e=jQuery.extend(!0,{},a),e.setPaginationKey(c.nextPaginationKey)),null!=b)return b.success(a,h,e)}else if(null!=b)return b.failure(a,"Unable to parse response")},failure:function(a){return null!=b?b.failure(g,a):void 0}},i.execute(f,!1)},b.prototype["delete"]=function(a){var b,c;return g=this,c=this._getRequest({path:this._generatePath(),withApp:!0}),c.setMethod("DELETE"),b={success:function(){return null!=a?a.success(g):void 0},failure:function(b){return null!=a?a.failure(g,b):void 0}},c.execute(b,!0)},b._bucketWithName=function(a,b){var d;return d=new c.KiiBucket(a,b)},b.prototype._getRequest=function(b){var c,d,e;return c=b.path,e=b.withApp,d=new a(c,e)},b.prototype._generatePath=function(){var a;return a=null!=this._user?"/users/"+this._user.getUUID()+"/buckets/"+this._bucketName:null!=this._group?"/groups/"+this._group.getUUID()+"/buckets/"+this._bucketName:"/buckets/"+this._bucketName},b.prototype.objectWithJSON=function(a){var b;return b=this.createObject(),b._updateWithJSON(a),b},b}.call(this),c.KiiBucketAdmin=function(a){function b(a,c,d){this.acl=f(this.acl,this),this.createObjectWithType=f(this.createObjectWithType,this),this.createObject=f(this.createObject,this),this._getRequest=f(this._getRequest,this),b.__super__.constructor.call(this,a,c),this._adminToken=d}var d;return h(b,a),d=null,b.prototype._getRequest=function(a){var c;return c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminToken),c},b.prototype.createObject=function(){return c.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},b.prototype.createObjectWithType=function(a){return c.KiiObjectAdmin.objectWithBucket(this,a,this._adminToken)},b.prototype.acl=function(){var a;return a=new c.KiiACLAdmin(this,this._adminToken)},b}(c.KiiBucket),c.KiiGroup=function(){function d(){this._setOwnerFromContext=f(this._setOwnerFromContext,this),this._userWithID=f(this._userWithID,this),this._getRequest=f(this._getRequest,this),this.getOwner=f(this.getOwner,this),this["delete"]=f(this["delete"],this),this.refresh=f(this.refresh,this),this.save=f(this.save,this),this.changeGroupName=f(this.changeGroupName,this),this._saveMembers=f(this._saveMembers,this),this.getMemberList=f(this.getMemberList,this),this._removeMember=f(this._removeMember,this),this._addMember=f(this._addMember,this),this.removeUser=f(this.removeUser,this),this.addUser=f(this.addUser,this),this.bucketWithName=f(this.bucketWithName,this),this.objectURI=f(this.objectURI,this),this._setOwner=f(this._setOwner,this),this.getCachedOwner=f(this.getCachedOwner,this),this._setName=f(this._setName,this),this.getName=f(this.getName,this),this._setUUID=f(this._setUUID,this),this.getUUID=f(this.getUUID,this),this._setAddMembers=f(this._setAddMembers,this),this._getRemoveMembers=f(this._getRemoveMembers,this),this._getAddMembers=f(this._getAddMembers,this),this._addMembers=[],this._removeMembers=[]}var e,g,h,i,j;return j=null,g=null,h=null,e=null,i=null,d.prototype._getAddMembers=function(){return this._addMembers},d.prototype._getRemoveMembers=function(){return this._removeMembers},d.prototype._setAddMembers=function(a){var b,c,d,e;if(null!=a){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this._addMembers.push(b));return e}},d.prototype.getUUID=function(){return this._uuid},d.prototype._setUUID=function(a){this._uuid=a},d.prototype.getName=function(){return this._groupName},d.prototype._setName=function(a){this._groupName=a},d.prototype.getCachedOwner=function(){return this._owner},d.prototype._setOwner=function(a){this._owner=a},d.prototype.objectURI=function(){return null!=this._uuid?"kiicloud://groups/"+this._uuid:null},d.prototype.bucketWithName=function(a){var b;return b=new c.KiiBucket(a,this)},d.prototype.addUser=function(a){var c;return $.inArray(a,-1===this._addMembers)&&this._addMembers.push(a),c=$.inArray(a,this._removeMembers),c>=0?b.arrayRemove(this._removeMembers,c,c):void 0},d.prototype.removeUser=function(a){var c;return $.inArray(a,-1===this._removeMembers)&&this._removeMembers.push(a),c=$.inArray(a,this._addMembers),c>=0?b.arrayRemove(this._addMembers,c,c):void 0},d.prototype._addMember=function(a,d){var e,f;return j=this,c.Kii.logger("Adding member "+a.getUUID()+" to group "+this._groupName),f=this._getRequest({path:"/groups/"+this._uuid+"/members/"+a.getUUID(),withApp:!0}),f.setMethod("PUT"),e={success:function(){var c;return c=$.inArray(a,j._getAddMembers()),b.arrayRemove(j._getAddMembers(),c,c),d.success(j)},failure:function(c){var e;return e=$.inArray(a,j._getAddMembers()),b.arrayRemove(j._getAddMembers(),e,e),d.failure(j,c)}},f.execute(e,!1)},d.prototype._removeMember=function(a,d){var e,f;return j=this,c.Kii.logger("Removing member "+a.getUUID()+" to group "+this._groupName),f=this._getRequest({path:"/groups/"+this._uuid+"/members/"+a.getUUID(),withApp:!0}),f.setMethod("DELETE"),e={success:function(){var c;return c=$.inArray(a,j._getRemoveMembers()),b.arrayRemove(j._getRemoveMembers(),c,c),d.success(j)},failure:function(c){var e;return e=$.inArray(a,j._getRemoveMembers()),b.arrayRemove(j._getRemoveMembers(),e,e),d.failure(j,c)}},f.execute(e,!1)},d.prototype.getMemberList=function(a){var b,d,e=this;return j=this,c.Kii.logger("Getting member list for group "+this._groupName),d=this._getRequest({path:"/groups/"+this._uuid+"/members",withApp:!0}),d.setAccept("application/vnd.kii.MembersRetrievalResponse+json"),b={success:function(b,c){var d,f,g,h,i;if(300>c&&c>=200){for(f=[],g=b.members,h=0,i=g.length;i>h;h++)d=g[h],f.push(e._userWithID(d.userID));if(null!=a)return a.success(j,f)}else if(null!=a)return a.failure(j,d,"Unable to get member list of group")},failure:function(b){return null!=a?a.failure(j,b):void 0}},d.execute(b,!1)},d.prototype._saveMembers=function(a){var b,c,d,e,f,g,h;for(j=this,g=this._removeMembers,c=0,e=g.length;e>c;c++)return b=g[c],void this._removeMember(b,a);for(h=this._addMembers,d=0,f=h.length;f>d;d++)return b=h[d],void this._addMember(b,a);return a.success(j)},d.prototype.changeGroupName=function(a,b){var d,e;return j=this,c.Kii.logger("Saving group: "+this.name),null!=this._uuid?(d=this._getRequest({path:"/groups/"+this._uuid+"/name",withApp:!0}),d.setContentType("text/plain"),d.setMethod("PUT"),d.setData(a),e={success:function(c,d){if(300>d&&d>=200){if(j._setName(a),null!=b)return b.success(j)}else if(null!=b)return b.failure(j,"Unable to change group name - invalid response")},failure:function(a){return null!=b?b.failure(j,a):void 0}},d.execute(e,!0)):b.failure(j,"Invalid group. Save the group on the server before updating the name.")},d.prototype.save=function(a){var b,d,e;return j=this,c.Kii.logger("Saving group: "+this.name),null==this._uuid?(d=this._getRequest({path:"/groups",withApp:!0}),d.setContentType("application/vnd.kii.GroupCreationRequest+json"),d.setMethod("POST"),b={},null!=this._groupName&&(b.name=this._groupName),this._setOwnerFromContext(b),d.setData(b),e={success:function(b,c){return 300>c&&c>=200?(j._setUUID(b.groupID),j._saveMembers(a)):void 0},failure:function(b){return null!=a?a.failure(j,b):void 0}},d.execute(e,!1)):this._saveMembers(a)},d.prototype.refresh=function(a){var b,d;return j=this,c.Kii.logger("Refreshing group: "+this._groupName),d=new this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),d.setAccept("application/vnd.kii.GroupRetrievalResponse+json"),b={success:function(b){return j=c.KiiGroup._groupWithJSON(b),null!=a?a.success(j):void 0},failure:function(b){return null!=a?a.failure(j,b):void 0}},d.execute(b,!1)},d.prototype["delete"]=function(a){var b,d;return j=this,c.Kii.logger("Deleting group: "+this._groupName),d=this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),d.setMethod("DELETE"),b={success:function(b,c){return 300>c&&c>=200&&null!=a?a.success(j):null!=a?a.failure(j,"Unable to parse response"):void 0},failure:function(b){return null!=a?a.failure(j,b):void 0}},d.execute(b,!0)},d.prototype.getOwner=function(a){return j=this,c.Kii.logger("Getting owner of group "+this._groupName),this.refresh({success:function(b){return null!=a?a.success(b,b.getCachedOwner()):void 0},failure:function(b,c){return null!=a?a.failure(b,c):void 0}})},d.groupWithName=function(a){return c.KiiGroup.groupWithNameAndMembers(a,null)},d.groupWithNameAndMembers=function(a,b){var d;return d=new c.KiiGroup,d._setName(a),d._setAddMembers(b),d},d.groupWithURI=function(a){var b,d,e,f;if(e=null,f=a.substr("kiicloud://".length),d=f.split("/"),b=d.length,!(b>0))throw new c.InvalidURIException;return e=new c.KiiGroup,e._setUUID(d[b-1]),e},d._groupWithID=function(a){var b;return b=new c.KiiGroup,b._setUUID(a),b},d._groupWithJSON=function(a){var b;return b=new c.KiiGroup,null!=a.groupID&&b._setUUID(a.groupID),null!=a.name&&b._setName(a.name),null!=a.owner&&b._setOwner(c.KiiUser._userWithID(a.owner)),b},d.prototype._getRequest=function(b){var c,d,e;return c=b.path,e=b.withApp,d=new a(c,e)},d.prototype._userWithID=function(a){var b;return b=c.KiiUser._userWithID(a)},d.prototype._setOwnerFromContext=function(a){return null!=c.Kii.getCurrentUser()?(this._owner=c.Kii.getCurrentUser(),a.owner=this._owner.getUUID()):void 0},d}.call(this),c.KiiObject=function(){function b(){this.moveBody=f(this.moveBody,this),this._parseObjectUri=f(this._parseObjectUri,this),this._userWithID=f(this._userWithID,this),this._getRequest=f(this._getRequest,this),this["delete"]=f(this["delete"],this),this.refresh=f(this.refresh,this),this.save=f(this.save,this),this.saveAllFields=f(this.saveAllFields,this),this._performSave=f(this._performSave,this),this._updateWithJSON=f(this._updateWithJSON,this),this.objectURI=f(this.objectURI,this),this.objectACL=f(this.objectACL,this),this.getGeoPoint=f(this.getGeoPoint,this),this.setGeoPoint=f(this.setGeoPoint,this),this.get=f(this.get,this),this.set=f(this.set,this),this._getPath=f(this._getPath,this),this._setBucket=f(this._setBucket,this),this.getBucket=f(this.getBucket,this),this._setObjectType=f(this._setObjectType,this),this.getObjectType=f(this.getObjectType,this),this._setModified=f(this._setModified,this),this.getModified=f(this.getModified,this),this._setCreated=f(this._setCreated,this),this.getCreated=f(this.getCreated,this),this._setUUID=f(this._setUUID,this),this.getUUID=f(this.getUUID,this),this._customInfo={}}var d,e,g,h,i,j,k,l;return k=null,b.prototype._alteredFields=[],l=null,e=null,h=null,i=null,g=null,d=null,j=null,b.prototype.getUUID=function(){return this._uuid},b.prototype._setUUID=function(a){this._uuid=a},b.prototype.getCreated=function(){return this._created},b.prototype._setCreated=function(a){this._created=a},b.prototype.getModified=function(){return this._modified},b.prototype._setModified=function(a){this._modified=a},b.prototype.getObjectType=function(){return this._objectType},b.prototype._setObjectType=function(a){this._objectType=a},b.prototype.getBucket=function(){return c.Kii.logger("GEtting bucket "+this._bucket),this._bucket},b.prototype._setBucket=function(a){this._bucket=a},b.prototype._getPath=function(){var a;return a=null!=this._bucket.getUser()?"/users/"+this._bucket.getUser().getUUID()+"/buckets/"+this._bucket.getBucketName()+"/objects/":null!=this._bucket.getGroup()?"/groups/"+this._bucket.getGroup().getUUID()+"/buckets/"+this._bucket.getBucketName()+"/objects/":"/buckets/"+this._bucket.getBucketName()+"/objects/",null!=this._uuid&&(a+=this._uuid),a},b.prototype.set=function(a,b){return this._customInfo[a]=b,this._alteredFields.push(a)},b.prototype.get=function(a){return this._customInfo[a]},b.prototype.setGeoPoint=function(a,b){if(!(b instanceof KiiGeoPoint))throw InvalidArgumentException("Specified kiiGeoPoint is not an instance of KiiGeoPoint");return this._customInfo[a]=b._toDict(),this._alteredFields.push(a)},b.prototype.getGeoPoint=function(a){var b,d,e;return e=this._customInfo[a],b=e.lat,d=e.lon,c.KiiGeoPoint.geoPoint(b,d)},b.prototype.objectACL=function(){return c.KiiACL.aclWithParent(this)},b.prototype.objectURI=function(){var a,b;return a="kiicloud://",null!=this._bucket&&null!=this._uuid&&(b=a,null!=this._bucket.getGroup()?b+="groups/"+this._bucket.getGroup().getUUID()+"/":null!=this._bucket.getUser()&&(b+="users/"+this._bucket.getUser().getUUID()+"/"),b+="buckets/"+this._bucket.getBucketName()+"/objects/"+this._uuid),b},b.prototype._updateWithJSON=function(a){var b,d,e;e=[];for(b in a)d=a[b],"objectID"===b||"_id"===b||"uuid"===b?(c.Kii.logger("Setting uuid: "+d),e.push(this._uuid=d)):e.push("createdAt"===b||"_created"===b||"created"===b?this._created=d:"modifiedAt"===b||"_modified"===b||"modified"===b?this._modified=d:"_owner"===b?this._owner=this._userWithID(d):"_dataType"===b?this._objectType=d:"_calculated"===b?this._customInfo[b]=d:"_"!==b[0]?this._customInfo[b]=d:void 0);return e},b.prototype._performSave=function(a,b){var d,e,f,g,h,i,j,l;if(k=this,f=this._getPath(),g=new this._getRequest({path:f,withApp:!0}),g.setMethod(null!=this._uuid?"PUT":"POST"),d={},a)d=this._customInfo;else for(l=this._alteredFields,i=0,j=l.length;j>i;i++)e=l[i],d[e]=this._customInfo[e];return g.setData(d),null!=this._objectType&&g.setContentType("application/vnd."+c.Kii.getAppID()+"."+this._objectType+"+json"),null==this._uuid||a||(g.addHeader("X-HTTP-Method-Override","PATCH"),g.setMethod("POST")),h={success:function(a,c){if(300>c&&c>=200){if(k._updateWithJSON(a),k._alteredFields=[],null!=b)return b.success(k)}else if(null!=b)return b.failure(k,"Unable to parse response")},failure:function(a){return null!=b?b.failure(k,a):void 0}},g.execute(h,!1)},b.prototype.saveAllFields=function(a){return this._performSave(!0,a)},b.prototype.save=function(a){return this._performSave(!1,a)},b.prototype.refresh=function(a){var b,c,d;return k=this,b=this._getPath(),d=new this._getRequest({path:b,withApp:!0}),c={success:function(b,c){if(300>c&&c>=200){if(k._updateWithJSON(b),null!=a)return a.success(k)}else if(null!=a)return a.failure(k,"Unable to parse response")},failure:function(b){return null!=a?a.failure(k,b):void 0}},d.execute(c,!1)},b.prototype["delete"]=function(a){var b,c,d;return k=this,b=this._getPath(),d=new this._getRequest({path:b,withApp:!0}),d.setMethod("DELETE"),c={success:function(b,c){return 300>c&&c>=200&&null!=a?a.success(k):null!=a?a.failure(k,"Unable to parse response"):void 0},failure:function(b){return null!=a?a.failure(k,b):void 0}},d.execute(c,!0)},b.objectWithBucket=function(a,b){var d;return c.Kii.logger("Creating object w type: "+b),d=new c.KiiObject,d._setBucket(a),d._setObjectType(b),c.Kii.logger(d),d},b.objectWithURI=function(a){var b,d,e,f,g,h,i,j,k,l;if(i=a.substr("kiicloud://".length),g=i.split("/"),f=g.length,c.Kii.logger(g),!(f>=4))throw new c.InvalidURIException;return d=4===f?1:3,e=g[d],"groups"===g[0]?h=new c.KiiGroup._groupWithID(g[1]):"users"===g[0]&&(l=c.KiiUser._userWithID(g[1])),k=null,null!=h?k=h:null!=l&&(k=l),b=new c.KiiBucket._bucketWithName(e,k),c.Kii.logger(b),j=b.createObject(),j._setUUID(g[f-1]),c.Kii.logger(j),j},b.prototype._getRequest=function(b){var c,d,e;return c=b.path,e=b.withApp,d=new a(c,e)},b.prototype._userWithID=function(a){var b;return b=c.KiiUser._userWithID(a)},b.prototype._parseObjectUri=function(a){var b,d,e,f;return e=a.replace(/^kiicloud:\/\//g,"").split("/"),f=e[0],"users"===f?(d={appID:c.Kii.getAppID(),userID:e[1],type:"APP_AND_USER"},b={targetObjectScope:d,targetBucketID:e[3],targetObjectID:e[5]}):"groups"===f?(d={appID:c.Kii.getAppID(),groupID:e[1],type:"APP_AND_GROUP"},b={targetObjectScope:d,targetBucketID:e[3],targetObjectID:e[5]}):(d={appID:c.Kii.getAppID(),type:"APP"},b={targetObjectScope:d,targetBucketID:e[1],targetObjectID:e[3]}),b},b.prototype.moveBody=function(a,b){var d,e,f,g;if(g=this,null==a)throw c.InvalidArgumentException("targetObjectUri is required");if(null==g.getUUID())throw c.InvalidArgumentException("Source object is not saved on the cloud");return e=this._getPath()+"/body/move",f=new this._getRequest({path:e,withApp:!0}),f.setMethod("POST"),f.setContentType("application/vnd.kii.ObjectBodyMoveRequest+json"),f.setData(this._parseObjectUri(a)),d={success:function(c,d){return 300>d&&d>=200&&null!=b?b.success(g,a):null!=b?b.failure(g,a,"Unable to parse response"):void 0},failure:function(c){return null!=b?b.failure(g,a,c):void 0}},f.execute(d,!0)},b}.call(this),c.KiiQuery=function(){function a(){this._dictValue=f(this._dictValue,this),this.sortByAsc=f(this.sortByAsc,this),this.sortByDesc=f(this.sortByDesc,this),this.setLimit=f(this.setLimit,this),this.getLimit=f(this.getLimit,this),this._setClause=f(this._setClause,this),this.setPaginationKey=f(this.setPaginationKey,this),this.getPaginationKey=f(this.getPaginationKey,this)}var b,d,e,g,h,i,j;return j=null,d=null,g=null,h=!1,i=null,e=25,b=null,a.prototype.getPaginationKey=function(){return this._paginationKey},a.prototype.setPaginationKey=function(a){this._paginationKey=a},a.prototype._setClause=function(a){this._clause=a},a.prototype.getLimit=function(){return this._limit},a.prototype.setLimit=function(a){if(a>0)return this._limit=a;throw new c.InvalidLimitException},a.queryWithClause=function(a){var b;return b=new c.KiiQuery,b._setClause(a),b},a.prototype.sortByDesc=function(a){return this._sortField=a,this._sortDescending=!0},a.prototype.sortByAsc=function(a){return this._sortField=a,this._sortDescending=!1},a._emptyDictValue=function(){return{type:"all"}},a.prototype._dictValue=function(){var a;return a={descending:this._sortDescending},a.clause=null!=this._clause?this._clause._getDictValue():c.KiiQuery._emptyDictValue(),null!=this._sortField&&(a.orderBy=this._sortField),a},a}.call(this),c.KiiClause=function(){function a(){this._getDictValue=f(this._getDictValue,this),this._setDictValue=f(this._setDictValue,this),this._setWhereClauses=f(this._setWhereClauses,this),this._setWhereType=f(this._setWhereType,this)}var b,d,e;return b=null,e=null,d=null,a.constructor=function(){return a._whereClauses=[],a._dictExpression={}},a.prototype._setWhereType=function(a){this._whereType=a},a.prototype._setWhereClauses=function(a){this._whereClauses=a},a.prototype._setDictValue=function(a){this._dictExpression=a},a.prototype._getDictValue=function(){var a,b,d,e,f,g;if(d={},null!=this._whereClauses&&null!=this._whereType)if(b=[],1===this._whereClauses.length)a=this._whereClauses[0],d="not"===this._whereType?{type:this._whereType,clause:a._getDictValue()}:a._getDictValue();else{for(g=this._whereClauses,e=0,f=g.length;f>e;e++)a=g[e],b.push(a._getDictValue());d={type:this._whereType,clauses:b}}else null!=this._whereClauses?this._whereClauses.length>0&&(d=this._whereClauses[0]._getDictValue()):null!=this._dictExpression&&(d=this._dictExpression);return null==d&&(d=c.KiiQuery.emptyDictValue()),d},a.createWithWhere=function(a,b){var d;return d=new c.KiiClause,d._setWhereType(a),d._setWhereClauses(b),d},a.create=function(a,b,d){var e,f;return e=new c.KiiClause,f={},"="===a?(f.type="eq",f.field=b,f.value=d):"<"===a?(f.type="range",f.field=b,f.upperLimit=d,f.upperIncluded=!1):"<="===a?(f.type="range",f.field=b,f.upperLimit=d,f.upperIncluded=!0):">"===a?(f.type="range",f.field=b,f.lowerLimit=d,f.lowerIncluded=!1):">="===a?(f.type="range",f.field=b,f.lowerLimit=d,f.lowerIncluded=!0):"in"===a?(f.type="in",f.field=b,f.values=d):"prefix"===a&&(f.type="prefix",f.field=b,f.prefix=d),e._setDictValue(f),e},a.and=function(){return a.createWithWhere("and",arguments)},a.or=function(){return a.createWithWhere("or",arguments)},a.equals=function(a,b){return null!=b._className&&(b=b.objectURI),c.KiiClause.create("=",a,b)},a.notEquals=function(a,b){return null!=b._className&&(b=b.objectURI),c.KiiClause.createWithWhere("not",[c.KiiClause.equals(a,b)])},a.greaterThan=function(a,b){return c.KiiClause.create(">",a,b)},a.greaterThanOrEqual=function(a,b){return c.KiiClause.create(">=",a,b)},a.lessThan=function(a,b){return c.KiiClause.create("<",a,b)},a.lessThanOrEqual=function(a,b){return c.KiiClause.create("<=",a,b)},a["in"]=function(a,b){return c.KiiClause.create("in",a,b)},a.startsWith=function(a,b){return c.KiiClause.create("prefix",a,b)},a.geoDistance=function(a,b,d,e){var f,g,h,i,j;if(h=function(a){return"string"==typeof a&&a.length>0},g=function(a){return null==a?!1:a instanceof KiiGeoPoint},!h(a))throw c.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!g(b))throw c.InvalidArgumentException("center is not a reference of KiiGeoPoint.");if(i="^[a-zA-Z_][a-zA-Z0-9_]*$",null!=e&&!e.match(i))throw c.InvalidArgumentException("putDistanceInto is invalid.");if(0>=d||d>2e7||isNaN(d))throw c.InvalidArgumentException("radius is invalid.");return f=new c.KiiClause,j={},j.type="geodistance",j.field=a,b=b._toDict(),j.center=b,j.radius=d,j.putDistanceInto=e,f._setDictValue(j),f},a.geoBox=function(a,b,d){var e,f,g,h,i,j;if(g=function(a){return"string"==typeof a&&a.length>0},f=function(a){return null==a?!1:a instanceof KiiGeoPoint},!g(a))throw c.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!f(b)||!f(d))throw c.InvalidArgumentException("northEast or southWest is not a reference of KiiGeoPoint.");return e=new c.KiiClause,j={},j.type="geobox",j.field=a,h=b._toDict(),i=d._toDict(),j.box={ne:h,sw:i},e._setDictValue(j),e
},a}.call(this),a=function(){function a(a,b){this.execute=f(this.execute,this),this.setAdminToken=f(this.setAdminToken,this),this.addHeader=f(this.addHeader,this),this.setAccept=f(this.setAccept,this),this.getAccept=f(this.getAccept,this),this.setAnonymous=f(this.setAnonymous,this),this.isAnonymous=f(this.isAnonymous,this),this.setContentType=f(this.setContentType,this),this.getContentType=f(this.getContentType,this),this.setData=f(this.setData,this),this.getData=f(this.getData,this),this.setHeaders=f(this.setHeaders,this),this.getHeaders=f(this.getHeaders,this),this.setMethod=f(this.setMethod,this),this.getMethod=f(this.getMethod,this),this.setPath=f(this.setPath,this),this.getPath=f(this.getPath,this);d=this,this._path=b?"/apps/"+c.Kii.getAppID()+a:a,this._method="GET",this._headers={accept:"*/*"},this._contentType="application/json",this._anonymous=!1,this._success=function(){},this._failure=function(){}}var b,d;return d=null,a._path=null,a._method=null,a._headers=null,a._data=null,a._contentType=null,a._anonymous=!1,a._accept=null,a._success=null,a._failure=null,b=null,a.prototype.getPath=function(){return this._path},a.prototype.setPath=function(a){this._path=a},a.prototype.getMethod=function(){return this._method},a.prototype.setMethod=function(a){this._method=a},a.prototype.getHeaders=function(){return this._headers},a.prototype.setHeaders=function(a){this._headers=a},a.prototype.getData=function(){return this._data},a.prototype.setData=function(a){this._data=a},a.prototype.getContentType=function(){return this._contentType},a.prototype.setContentType=function(a){this._contentType=a},a.prototype.isAnonymous=function(){return this._anonymous},a.prototype.setAnonymous=function(a){this._anonymous=a},a.prototype.getAccept=function(){return this._accept},a.prototype.setAccept=function(a){this._accept=a},a.prototype.addHeader=function(a,b){return this._headers[a]=b},a.prototype.setAdminToken=function(a){return this._adminToken=a},a.prototype.execute=function(a,b){var e,f,g,h,i,j,k;this._success=null!=a.success?a.success:this._success,this._failure=null!=a.failure?a.failure:this._failure,i=c.Kii.getBaseURL()+this._path,c.Kii.logger("POSTING: "),c.Kii.logger(this._data),null!=this._data&&(h={}),k=this._data;for(g in k)j=k[g],h[g]=encodeURIComponent(j);return f=JSON.stringify(this._data),c.Kii.logger("Making request["+this._method+"] to "+i+" with data: "+f),this._headers["x-kii-appid"]=c.Kii.getAppID(),this._headers["x-kii-appkey"]=c.Kii.getAppKey(),this._headers["x-kii-sdk"]=c.KiiSDKClientInfo.getSDKClientInfo(),null!=this._accept&&(this._headers.accept=this._accept),this._anonymous||null==c.KiiUser.getCurrentUser()||(this._headers.Authorization="Bearer "+c.KiiUser.getCurrentUser().getAccessToken()),null!=this._adminToken&&(this._headers.Authorization="Bearer "+this._adminToken),c.Kii.logger("Headers: "),c.Kii.logger(this._headers),$.support.cors=!0,e={type:this._method,url:i,dataType:"json",headers:this._headers,contentType:this._contentType,error:function(a,b,e){var f,g;f=e?e:b+" : "+i;try{g=jQuery.parseJSON(decodeURIComponent(a.responseText))}catch(h){e=h,g=null}return null!=g&&null!=g.errorCode&&(f=g.errorCode,null!=g.message&&(f+=": "+g.message)),c.Kii.logger("Failure: "+f),c.Kii.logger(a.responseText),d._failure(f,a.status)},success:function(a,e,f){var g,h,i;if(c.Kii.logger("Completed Request["+f.status+"]"),c.Kii.logger(f.responseText),b)return d._success(null,f.status);try{i=jQuery.parseJSON(f.responseText)}catch(j){g=j,i=null}return null!=i?null!=i.errorCode?(h=i.errorCode,null!=i.message&&(h+=": "+i.message),d._failure(h,f.status,i.errorCode)):d._success(i,f.status):d._success(null,f.status,null)}},"GET"!==this._method&&null!=f&&(e.data=f,e.processData=!1),$.ajax(e)},a}(),c.KiiUser=function(){function d(){this._getRequest=f(this._getRequest,this),this._updateWithJSON=f(this._updateWithJSON,this),this["delete"]=f(this["delete"],this),this.refresh=f(this.refresh,this),this.save=f(this.save,this),this.changeEmail=f(this.changeEmail,this),this.changePhone=f(this.changePhone,this),this.ownerOfGroups=f(this.ownerOfGroups,this),this.memberOfGroups=f(this.memberOfGroups,this),this.resendPhoneNumberVerification=f(this.resendPhoneNumberVerification,this),this.resendEmailVerification=f(this.resendEmailVerification,this),this.resendVerification=f(this.resendVerification,this),this.verifyPhoneNumber=f(this.verifyPhoneNumber,this),this.verifyCredentials=f(this.verifyCredentials,this),this.updatePassword=f(this.updatePassword,this),this.register=f(this.register,this),this._authenticateWithToken=f(this._authenticateWithToken,this),this._authenticate=f(this._authenticate,this),this.bucketWithName=f(this.bucketWithName,this),this.get=f(this.get,this),this.set=f(this.set,this),this.objectURI=f(this.objectURI,this),this._setAccessToken=f(this._setAccessToken,this),this.getAccessToken=f(this.getAccessToken,this),this._setPhoneVerified=f(this._setPhoneVerified,this),this.getPhoneVerified=f(this.getPhoneVerified,this),this._setEmailVerified=f(this._setEmailVerified,this),this.getEmailVerified=f(this.getEmailVerified,this),this._setModified=f(this._setModified,this),this.getModified=f(this.getModified,this),this._setCreated=f(this._setCreated,this),this.getCreated=f(this.getCreated,this),this.setCountry=f(this.setCountry,this),this.getCountry=f(this.getCountry,this),this._setPassword=f(this._setPassword,this),this._setPhoneNumber=f(this._setPhoneNumber,this),this.getPhoneNumber=f(this.getPhoneNumber,this),this._setEmailAddress=f(this._setEmailAddress,this),this.getEmailAddress=f(this.getEmailAddress,this),this._validateDisplayName=f(this._validateDisplayName,this),this.setDisplayName=f(this.setDisplayName,this),this.getDisplayName=f(this.getDisplayName,this),this._setUsername=f(this._setUsername,this),this.getUsername=f(this.getUsername,this),this._setUUID=f(this._setUUID,this),this.getUUID=f(this.getUUID,this),this._customInfo={}}var e,g,h,i,j,k,l,m,n,o,p,q,r,s;return q=null,s=null,r=null,j=null,n=null,k=null,o=null,g=null,h=null,m=null,l=null,p=null,e=null,i=null,d.prototype.getUUID=function(){return this._uuid},d.prototype._setUUID=function(a){this._uuid=a},d.prototype.getUsername=function(){return this._username},d.prototype._setUsername=function(a){if(c.Kii.logger("Setting username: "+a),b._validateUsername(a))return this._username=$.trim(a);throw new c.InvalidUsernameException},d.prototype.getDisplayName=function(){return this._displayName},d.prototype.setDisplayName=function(a){return this._validateDisplayName(a),this._displayName=a},d.prototype._validateDisplayName=function(a){if(typeof a===!1)throw new c.InvalidDisplayNameException;if(4>a.length||a.length>50)throw new c.InvalidDisplayNameException},d.prototype.getEmailAddress=function(){return this._emailAddress},d.prototype._setEmailAddress=function(a){if(c.Kii.logger("Setting email: "+a),b._validateEmail(a))return this._emailAddress=$.trim(a);throw new c.InvalidEmailException},d.prototype.getPhoneNumber=function(){return this._phoneNumber},d.prototype._setPhoneNumber=function(a){if(c.Kii.logger("Setting phone number: "+a),b._validatePhoneNumber(a))return this._phoneNumber=a;throw new c.InvalidPhoneNumberException},d.prototype._setPassword=function(a){if(b._validatePassword(a))return this._password=a;throw new c.InvalidPasswordException},d.prototype.getCountry=function(){return this._country},d.prototype.setCountry=function(a){if(b._validateCountryCode(a))return this._country=a;throw new c.InvalidCountryException},d.prototype.getCreated=function(){return this._created},d.prototype._setCreated=function(a){this._created=a},d.prototype.getModified=function(){return this._modified},d.prototype._setModified=function(a){this._modified=a},d.prototype.getEmailVerified=function(){return this._emailVerified},d.prototype._setEmailVerified=function(a){this._emailVerified=a},d.prototype.getPhoneVerified=function(){return this._phoneVerified},d.prototype._setPhoneVerified=function(a){this._phoneVerified=a},d.prototype.getAccessToken=function(){return c.Kii.logger("Getting access token: "+this._accessToken),this._accessToken},d.prototype._setAccessToken=function(a){return this._accessToken=a,c.Kii.logger("Setting access token: "+this._accessToken)},d.prototype.objectURI=function(){var a;return null!=this._uuid&&(a="kiicloud://users/"+this._uuid),a},d.prototype.set=function(a,b){return c.Kii.logger(this),c.Kii.logger(this._customInfo),this._customInfo[a]=b},d.prototype.get=function(a){return this._customInfo[a]},d.getCurrentUser=function(){return c.Kii.getCurrentUser()},d.userWithUsername=function(a,b){var d;return d=new c.KiiUser,d._setUsername(a),d._setPassword(b),d},d._userWithEmailAddress=function(a,b){var d;return d=new c.KiiUser,d._setEmailAddress(a),d._setPassword(b),d},d._userWithPhoneNumber=function(a,b){var d;return d=new c.KiiUser,d._setPhoneNumber(a),d._setPassword(b),d},d.userWithPhoneNumber=function(a,b){var d;return d=new c.KiiUser,d._setPhoneNumber(a),d._setPassword(b),d},d.userWithPhoneNumberAndUsername=function(a,b,d){var e;return e=new c.KiiUser,e._setPhoneNumber(a),e._setUsername(b),e._setPassword(d),e},d.userWithEmailAddress=function(a,b){var d;return d=new c.KiiUser,d._setEmailAddress(a),d._setPassword(b),d},d.userWithEmailAddressAndUsername=function(a,b,d){var e;return e=new c.KiiUser,e._setEmailAddress(a),e._setUsername(b),e._setPassword(d),e},d.userWithEmailAddressAndPhoneNumber=function(a,b,d){var e;return e=new c.KiiUser,e._setEmailAddress(a),e._setPhoneNumber(b),e._setPassword(d),e},d.userWithCredentials=function(a,b,d,e){var f;return f=new c.KiiUser,f._setEmailAddress(a),f._setPhoneNumber(b),f._setUsername(d),f._setPassword(e),f},d._validateURI=function(a){var b,c,d;return a=$.trim(a),c=/^kiicloud:\/\/users\/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})$/i,"string"===(typeof a).toLowerCase()&&(b=a.match(c),null!=b&&(d=b[1])),d},d.userWithURI=function(a){var b,d;if(c.Kii.logger("About to extract from: "+a),d=c.KiiUser._validateURI(a),c.Kii.logger("Extracted uuid from uri: "+d),null==d)throw new c.InvalidURIException;return b=new c.KiiUser,b._setUUID(d),b},d._userWithID=function(a){var b;return b=new c.KiiUser,b._setUUID(a),b},d.prototype.bucketWithName=function(a){return new c.KiiBucket._bucketWithName(a,this)},d.prototype._authenticate=function(a){var b,d,e;return q=this,c.Kii.logger("Authenticating user:"),c.Kii.logger(this),c.Kii.logger("Email verified: "+this._emailVerified),c.Kii.logger("Phone verified: "+this._phoneVerified),null!=this._username?e=this._username:null!=this._emailAddress&&this._emailVerified===!0?e=this._emailAddress:null!=this._phoneNumber&&this._phoneVerified===!0?e=this._phoneNumber:null!=this._emailAddress?e=this._emailAddress:null!=this._phoneNumber&&(e=this._phoneNumber),d=this._getRequest({path:"/oauth2/token",withApp:!1}),d.setAnonymous(!0),d.setMethod("POST"),d.setData({username:e,password:this._password}),b={success:function(b){return q._setUUID(b.id),q._setAccessToken(b.access_token),c.Kii.setCurrentUser(q),null!=a?a.success(c.Kii.getCurrentUser()):void 0},failure:function(b){return null!=a?a.failure(q,b):void 0}},d.execute(b,!1)},d.prototype._authenticateWithToken=function(a,b){var d,e;return q=this,c.Kii.logger("Authenticating user "+this),c.Kii.logger(b),e=this._getRequest({path:"/users/me",withApp:!0}),e.setAnonymous(!0),e.addHeader("Authorization","Bearer "+a),d={success:function(d){return q._updateWithJSON(d),q._setAccessToken(a),c.Kii.setCurrentUser(q),null!=b?b.success(c.Kii.getCurrentUser()):void 0},failure:function(a){return null!=b?b.failure(q,a):void 0}},e.execute(d,!1)},d.authenticate=function(a,d,e){var f,g;try{if(c.Kii.logger("UserIdentifier: "+a),!b._validatePassword(d))throw new c.InvalidPasswordException;if(b._validateEmail(a))g=c.KiiUser._userWithEmailAddress(a,d);else if(b._validatePhoneNumber(a))g=c.KiiUser._userWithPhoneNumber(a,d);else{if(!b._validateUsername(a))throw new c.InvalidUserIdentifierException;g=c.KiiUser.userWithUsername(a,d)}return g._authenticate(e)}catch(h){if(f=h,null!=e)return e.failure(null,f.message)}},d.authenticateWithToken=function(a,b){var d;return d=new c.KiiUser,d._authenticateWithToken(a,b)},d.prototype.register=function(a){var b,d,e,f,g,h;q=this,c.Kii.logger("Registering user "+this),b={password:this._password},null!=this._username&&(b.loginName=this._username),null!=this._displayName&&(b.displayName=this._displayName),null!=this._emailAddress&&(b.emailAddress=this._emailAddress),null!=this._phoneNumber&&(b.phoneNumber=this._phoneNumber),null!=this._country&&(b.country=this._country),c.Kii.logger("CINFO"),c.Kii.logger(this._customInfo),h=this._customInfo;for(d in h)g=h[d],c.Kii.logger("Key/val: "+d+"/"+g),b[d]=g;return f=this._getRequest({path:"/users",withApp:!0}),f.setMethod("POST"),f.setData(b),f.setAnonymous(!0),f.setContentType("application/vnd.kii.RegistrationRequest+json"),e={success:function(b){return c.Kii.logger("Succreg"),q._updateWithJSON(b),q._authenticate(a)},failure:function(b){return c.Kii.logger("Failreg"),null!=a?a.failure(q,b):void 0}},f.execute(e,!1)},d.prototype.updatePassword=function(a,d,e){var f,g,h,i;return q=this,c.Kii.logger("Updating password from "+a+" to "+d),b._validatePassword(d)?(f={oldPassword:a,newPassword:d},g="/users/"+this._uuid+"/password",h=this._getRequest({path:g,withApp:!0}),h.setMethod("PUT"),h.setData(f),h.setContentType("application/vnd.kii.ChangePasswordRequest+json"),i={success:function(a,b){if(300>b&&b>=200){if(q._setPassword(d),null!=e)return e.success(q)}else if(null!=e)return e.failure(q,"Unable to change password")},failure:function(a){return null!=e?e.failure(q,a):void 0}},h.execute(i,!0)):null!=e?e.failure(q,(new c.InvalidPasswordException).message):void 0},d.resetPassword=function(d,e){var f,g,h,i;if(c.Kii.logger("Resetting password with identifier: "+d),b._validateEmail(d))f="EMAIL";else if(null!=e)return void e.failure("Invalid user identifier. Must be a valid email address");return null!=f?(g="/users/"+f+":"+d+"/password/request-reset",h=new a(g,!0),h.setMethod("POST"),h.setAnonymous(!0),i={success:function(a,b){return 300>b&&b>=200&&null!=e?e.success():null!=e?e.failure("Unable to reset password"):void 0},failure:function(a){return null!=e?e.failure(a):void 0}},h.execute(i,!0)):void 0},d.prototype.verifyCredentials=function(a,b,d){var e,f,g;return q=this,c.Kii.logger("Verifying "+a+" with code: "+b),e="/users/me/"+a+"/verify",f=this._getRequest({path:e,withApp:!0}),f.setMethod("POST"),f.setData({verificationCode:b}),f.setContentType("application/vnd.kii.AddressVerificationRequest+json"),g={success:function(b,c){if(300>c&&c>=200){if("email-address"===a?q._setEmailVerified(!0):"phone-number"===a&&q._setPhoneVerified(!0),null!=d)return d.success(q)}else if(null!=d)return d.failure(q,"Unable to verify "+a)},failure:function(a){return null!=d?d.failure(q,a):void 0}},f.execute(g,!0)},d.prototype.verifyPhoneNumber=function(a,b){return this.verifyCredentials("phone-number",a,b)},d.prototype.resendVerification=function(a,b){var d,e,f;return q=this,c.Kii.logger("Resending verification "+a),d="/users/me/"+a+"/resend-verification",e=this._getRequest({path:d,withApp:!0}),e.setMethod("POST"),f={success:function(c,d){return 300>d&&d>=200&&null!=b?b.success(q):null!=b?b.failure(q,"Unable to resend "+a+" verification"):void 0},failure:function(a){return null!=b?b.failure(q,a):void 0}},e.execute(f,!0)},d.prototype.resendEmailVerification=function(a){return this.resendVerification("email-address",a)},d.prototype.resendPhoneNumberVerification=function(a){return this.resendVerification("phone-number",a)},d.prototype.memberOfGroups=function(a){var b,d,e;return q=this,c.Kii.logger("Getting groups for member "+this._uuid),d="/groups/?is_member="+this._uuid,e=this._getRequest({path:d,withApp:!0}),e.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),b={success:function(b,d){var e,f,g,h,i;if(300>d&&d>=200){for(f=[],i=b.groups,g=0,h=i.length;h>g;g++)e=i[g],f.push(c.KiiGroup._groupWithJSON(e));if(null!=a)return a.success(q,f)}else if(null!=a)return a.failure(q,"Unable to retrieve groups")},failure:function(b){return null!=a?a.failure(q,b):void 0}},e.execute(b,!1)},d.prototype.ownerOfGroups=function(a){var b,d,e;return q=this,c.Kii.logger("Getting groups owned by the user "+this._uuid),d="/groups/?owner="+this._uuid,e=this._getRequest({path:d,withApp:!0}),e.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),b={success:function(b,d){var e,f,g,h,i;if(300>d&&d>=200){for(f=[],i=b.groups,g=0,h=i.length;h>g;g++)e=i[g],f.push(c.KiiGroup._groupWithJSON(e));if(null!=a)return a.success(q,f)}else if(null!=a)return a.failure(q,"Unable to retrieve groups")},failure:function(b){return null!=a?a.failure(q,b):void 0}},e.execute(b,!1)},d.prototype.changePhone=function(a,b){var d,e,f;return q=this,c.Kii.logger("Updating phone number to "+a),d="/users/"+this._uuid+"/phone-number",e=this._getRequest({path:d,withApp:!0}),e.setMethod("PUT"),e.setContentType("application/vnd.kii.PhoneNumberModificationRequest+json"),e.setData({phoneNumber:a}),f={success:function(c,d){return 300>d&&d>=200&&null!=b?(q._setPhoneVerified(!1),q._setPhoneNumber(a),b.success(q)):null!=b?b.failure(q,"Unable to update phone number"):void 0},failure:function(a){return null!=b?b.failure(q,a):void 0}},e.execute(f,!0)},d.prototype.changeEmail=function(a,d){var e,f,g;return q=this,c.Kii.logger("Updating email address to: "+a),b._validateEmail(a)?(e="/users/"+this._uuid+"/email-address",f=this._getRequest({path:e,withApp:!0}),f.setMethod("PUT"),f.setContentType("application/vnd.kii.EmailAddressModificationRequest+json"),f.setData({emailAddress:a}),g={success:function(b,c){return 300>c&&c>=200&&null!=d?(q._setEmailVerified(!1),q._setEmailAddress(a),d.success(q)):null!=d?d.failure(q,"Unable to update email address"):void 0},failure:function(a){return null!=d?d.failure(q,a):void 0}},f.execute(g,!0)):d.failure(q,"Invalid email address format")},d.prototype.save=function(a){var b,d,e,f;return q=this,c.Kii.logger("Saving user: "+this._uuid),d="/users/"+this._uuid,c.Kii.logger("CUSTOMINFO: "),c.Kii.logger(this._customInfo),e=this._getRequest({path:d,withApp:!0}),e.setMethod("POST"),e.setContentType("application/vnd.kii.UserUpdateRequest+json"),b=this._customInfo,null!=this._country&&(b.country=this._country),null!=this._displayName&&(b.displayName=this._displayName),e.setData(b),f={success:function(b,c){if(300>c&&c>=200){if(q._setModified(b.modifiedAt),null!=a)return a.success(q)}else if(null!=a)return a.failure(q,"Unable to parse response")},failure:function(b){return null!=a?a.failure(q,b):void 0}},e.execute(f,!1)},d.prototype.refresh=function(a){var b,d;return q=this,c.Kii.logger("Refreshing user: "+this._uuid),d=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),b={success:function(b,c){if(300>c&&c>=200){if(q._updateWithJSON(b),null!=a)return a.success(q)}else if(null!=a)return a.failure(q,"Unable to parse response")},failure:function(b){return null!=a?a.failure(q,b):void 0}},d.execute(b,!1)},d.prototype["delete"]=function(a){var b,d;return c.Kii.logger("Deleting user..."),q=this,d=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),d.setMethod("DELETE"),b={success:function(b,c){return 300>c&&c>=200&&null!=a?a.success(q):null!=a?a.failure(q,"Unable to parse response"):void 0},failure:function(b){return null!=a?a.failure(q,b):void 0}},d.execute(b,!0)},d.logOut=function(){return c.Kii.logOut()},d.loggedIn=function(){return c.Kii.loggedIn()},d.getCurrentUser=function(){return c.Kii.getCurrentUser()},d.prototype._updateWithJSON=function(a){var b,d;c.Kii.logger("Updating with:"),c.Kii.logger(a);for(b in a)d=a[b],c.Kii.logger("key/val => "+b+"/"+d),c.Kii.logger("Substr "+b.substring(0,1)),"userID"===b||"id"===b?this._uuid=d:"created"===b||"createdAt"===b||"_created"===b?this._created=d:"modified"===b||"modifiedAt"===b||"_modified"===b?this._modified=d:"loginName"===b?this._username=d:"displayName"===b?this._displayName=d:"country"===b?(c.Kii.logger("Is setting country"),this._country=d):"emailAddress"===b?this._emailAddress=d:"phoneNumber"===b?this._phoneNumber=d:"emailAddressVerified"===b?(c.Kii.logger("Email verified: "+d),this._emailVerified=d):"phoneNumberVerified"===b?(c.Kii.logger("Phone verified: "+d),this._phoneVerified=d):""===b?(c.Kii.logger("Setting empty to custom info"),this._customInfo[b]=d):b.substring(0,!0)?(c.Kii.logger("Setting to custom info"),this._customInfo[b]=d):c.Kii.logger("Doing nothing");return null==this._displayName&&null!=this._username?this._displayName=this._username:void 0},d.prototype._getRequest=function(b){var c,d,e;return c=b.path,e=b.withApp,d=new a(c,e)},d}.call(this),b=function(){function a(){}return a.arrayRemove=function(a,b,c){var d;return d=a.slice((c||b)+1||a.length),a.length=0>b?a.length+b:b,a.push.apply(a,d)},a._validateEmail=function(a){var b;return a=$.trim(a),b=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i,"string"!==(typeof a).toLowerCase()?(c.Kii.logger("Not string"),!1):a.match(b)?!0:!1},a._validatePhoneNumber=function(a){var b;return a=$.trim(a),b=/^[\\+]+[0-9]{10,}$/i,"string"!==(typeof a).toLowerCase()?(c.Kii.logger("Not string"),!1):a.match(b)?!0:!1},a._validateLocalPhone=function(a){var b;return a=$.trim(a),b=/^\d+$/,"string"!==(typeof a).toLowerCase()?(c.Kii.logger("Not string"),!1):a.match(b)?!0:(c.Kii.logger("Invalid format"),!1)},a._assertLocalPhoneIsValid=function(b){if(!a._validateLocalPhone(b))throw new c.InvalidLocalPhoneNumberException},a._validateCountryCode=function(a){var b;return a=$.trim(a),b=/^[a-z]{2}$/i,"string"!==(typeof a).toLowerCase()?(c.Kii.logger("Not string"),!1):a.match(b)?(c.Kii.logger("Is true"),!0):!1},a._assertCountryCodeIsValid=function(b){if(!a._validateCountryCode(b))throw new c.InvalidCountryException},a._validatePassword=function(a){var b;return c.Kii.logger("Validating password: "+a),b=/^[\x20-\x7E]{4,50}$/,"string"!==(typeof a).toLowerCase()?(c.Kii.logger("not string"),!1):a.match(b)?(c.Kii.logger("matched"),!0):(c.Kii.logger("other exception"),!1)},a._assertPasswordIsValid=function(b){if(!a._validatePassword(b))throw new c.InvalidPasswordException},a._validateUsername=function(a){var b;return b=/^[a-zA-Z0-9-_\\.]{3,64}$/i,"string"!==(typeof a).toLowerCase()?!1:a.match(b)?!0:!1},a}.call(this),c.KiiSocialConnect=function(){function a(){}var b;return b=null,a.setupNetwork=function(a,d,f,g){var h;return null==b&&(b=new e),h=b._getManager(a),h._reset(),h._setup(d,f,g),c.Kii.logger("Set key: "+h._key)},a.logIn=function(a,d,e){var f;return f=!1,null!=b&&(c.Kii.logger("And manager: "),c.Kii.logger(b._getManager(a)),b._getManager(a)&&(b._getManager(a)._logIn(d,e),f=!0)),c.Kii.logger("Callbacks"),c.Kii.logger(e),f||null==e?void 0:e.failure(c.KiiUser.getCurrentUser(),a,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},a.linkCurrentUserWithNetwork=function(a,d,e){var f;return c.Kii.logger("Trying with instance"),c.Kii.logger(b),f=!1,null!=b&&(c.Kii.logger("And manager: "),c.Kii.logger(b._getManager(a)),b._getManager(a)&&(b._getManager(a)._linkWithCurrentUser(d,e),f=!0)),c.Kii.logger("Callbacks"),c.Kii.logger(e),f||null==e?void 0:e.failure(c.KiiUser.getCurrentUser(),a,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},a.unLinkCurrentUserFromNetwork=function(a,d){if(c.Kii.logger("Trying with instance"),c.Kii.logger(b),null!=b){if(c.Kii.logger("And manager: "),c.Kii.logger(b._getManager(a)),b._getManager(a))return b._getManager(a)._unlinkFromCurrentUser(d)}else if(null!=d)return d.failure(c.KiiUser.getCurrentUser(),a,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},a.getAccessTokenForNetwork=function(a){return b._getManager(a)._getToken()},a.getAccessTokenExpirationForNetwork=function(a){return b._getManager(a)._getTokenExpiration()},a.getAccessTokenObjectForNetwork=function(a){return b._getManager(a)._getTokenObject()},a.logOutAll=function(){var a,d;return null!=b&&(a=b._getManager(c.KiiSocialNetworkName.FACEBOOK),null!=a&&a._logOut(),d=b._getManager(c.KiiSocialNetworkName.TWITTER),null!=d)?d._logOut():void 0},a}.call(this),e=function(){function a(){this._getManager=f(this._getManager,this)}var b,d;return b=null,d=null,a.prototype._getManager=function(a){return a===c.KiiSocialNetworkName.FACEBOOK?null!=this._facebookManager?this._facebookManager:this._facebookManager=new c.KiiSCNFacebook:a===c.KiiSocialNetworkName.TWITTER?null!=this._twitterManager?this._twitterManager:this._twitterManager=new c.KiiSCNTwitter:void 0},a}(),c.KiiSocialConnectNetwork=function(){function a(a){this._network=a,this._setup=f(this._setup,this),this._unlinkFromCurrentUser=f(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=f(this._linkWithCurrentUser,this),this._logOut=f(this._logOut,this),this._logIn=f(this._logIn,this),this._reset=f(this._reset,this),this._isAuthenticated=f(this._isAuthenticated,this),this._getCallbacks=f(this._getCallbacks,this),this._setCallbacks=f(this._setCallbacks,this),this._getTokenObject=f(this._getTokenObject,this),this._setTokenObject=f(this._setTokenObject,this),this._getTokenExpiration=f(this._getTokenExpiration,this),this._setTokenExpiration=f(this._setTokenExpiration,this),this._getToken=f(this._getToken,this),this._setToken=f(this._setToken,this),this._getExtras=f(this._getExtras,this),this._setExtras=f(this._setExtras,this),this._getSecret=f(this._getSecret,this),this._setSecret=f(this._setSecret,this),this._getKey=f(this._getKey,this),this._setKey=f(this._setKey,this),this._getNetwork=f(this._getNetwork,this),this._setNetwork=f(this._setNetwork,this)}var b,c,d,e,g,h,i,j;return a.prototype._className="KiiSocialConnectNetwork",e=null,d=null,g=null,c=null,h=null,i=null,j=null,b=null,a.prototype._setNetwork=function(a){this._network=a},a.prototype._getNetwork=function(){return this._network},a.prototype._setKey=function(a){this._key=a},a.prototype._getKey=function(){return this._key},a.prototype._setSecret=function(a){this._secret=a},a.prototype._getSecret=function(){return this._secret},a.prototype._setExtras=function(a){this._extras=a},a.prototype._getExtras=function(){return this._extras},a.prototype._setToken=function(a){this._token=a},a.prototype._getToken=function(){return this._token},a.prototype._setTokenExpiration=function(a){this._tokenExpiration=a},a.prototype._getTokenExpiration=function(){return this._tokenExpiration},a.prototype._setTokenObject=function(a){this._tokenObject=a},a.prototype._getTokenObject=function(){return this._tokenObject},a.prototype._setCallbacks=function(a){this._callbacks=a},a.prototype._getCallbacks=function(){return this._callbacks},a.prototype._isAuthenticated=function(){return null!=this._tokenObject},a.prototype._reset=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null,this._key=null,this._secret=null,this._extras=null},a.prototype._logIn=function(a,b){this._callbacks=b},a.prototype._logOut=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null},a.prototype._linkWithCurrentUser=function(a,b){this._callbacks=b},a.prototype._unlinkFromCurrentUser=function(a){this._callbacks=a},a.prototype._setup=function(a,b,c){this._key=a,this._secret=b,this._extras=c},a}(),c.KiiSCNFacebook=function(b){function d(){this._unlinkFromCurrentUser=f(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=f(this._linkWithCurrentUser,this),this._logOut=f(this._logOut,this),this._logIn=f(this._logIn,this),this._unlink=f(this._unlink,this),this._link=f(this._link,this),this._register=f(this._register,this),this._setup=f(this._setup,this),d.__super__.constructor.call(this,KiiSocialNetworkName.FACEBOOK)}var e;return h(d,b),e=null,d.prototype._setup=function(a,b,e){return this._key=a,this._secret=b,this._extras=e,d.__super__._setup.call(this,this._key,this._secret,this._extras),this._extras.appId=this._key,c.Kii.logger(this._extras),FB.init(this._extras)},d.prototype._register=function(b,d){var e,f,g=this;return g=this,f=new a("/integration/facebook",!0),f.setMethod("POST"),f.setData({accessToken:b}),f.setAnonymous(!0),f.setContentType("application/vnd.kii.AuthTokenFacebookRequest+json"),e={success:function(a){var e,f;return g._setToken(b),g._setTokenExpiration(d),e={access_token:b,expires_in:d},g._setTokenObject(e),f=new c.KiiUser,f._updateWithJSON(a),f._setAccessToken(a.access_token),c.Kii.setCurrentUser(f),null!=g._callbacks?g._callbacks.success(c.KiiUser.getCurrentUser(),g._network):void 0},failure:function(a){return null!=g._callbacks?g._callbacks.failure(null,g._network,a):void 0}},f.execute(e,!1)},d.prototype._link=function(b,d){var e,f,g=this;return g=this,f=new a("/users/me/facebook/link",!0),f.setMethod("POST"),f.setData({accessToken:b}),e={success:function(){var a;return g._setToken(b),g._setTokenExpiration(d),a={access_token:b,expires_in:d},g._setTokenObject(a),null!=g._callbacks?g._callbacks.success(c.KiiUser.getCurrentUser(),g._network):void 0},failure:function(a){return null!=g._callbacks?g._callbacks.failure(c.KiiUser.getCurrentUser(),g._network,a):void 0}},f.execute(e,!0)},d.prototype._unlink=function(){var b,d,e=this;return e=this,b=new a("/users/me/facebook/unlink",!0),b.setMethod("POST"),d={success:function(){return e._setToken(null),e._setTokenExpiration(null),e._setTokenObject(null),null!=e._callbacks?e._callbacks.success(c.KiiUser.getCurrentUser(),e._network):void 0},failure:function(a){return null!=e._callbacks?e._callbacks.failure(c.KiiUser.getCurrentUser(),e._network,a):void 0}},b.execute(d,!0)},d.prototype._logIn=function(a,b){var e,f,g,h=this;return d.__super__._logIn.call(this,a,b),c.Kii.logger("should auth fb"),h=this,c.Kii.logger("Checking options"),c.Kii.logger(a),e=function(a){return null!=a.authResponse?(null!=c.KiiUser.getCurrentUser()&&KiiUser.logOut(),h._register(a.authResponse.accessToken,a.authResponse.expiresIn)):null!=h._callbacks?h._callbacks.failure(null,h._network,"User cancelled login or did not fully authorize"):void 0},null!=a&&null!=a.access_token?(c.Kii.logger("Have options: "),c.Kii.logger(a),null!=c.KiiUser.getCurrentUser()&&KiiUser.logOut(),h._register(a.access_token,null)):(f=null,null!=a&&null!=a.scope&&(f={scope:a.scope}),g=function(a){return"connected"===a.status?e(a):FB.login(e,f)},FB.getLoginStatus(g),g=function(a){return"connected"===a.status?e(a):FB.login(e)},FB.getLoginStatus(g))},d.prototype._logOut=function(){return d.__super__._logOut.apply(this,arguments),c.Kii.logger("Log out fb")},d.prototype._linkWithCurrentUser=function(a,b){var e,f,g,h;return d.__super__._linkWithCurrentUser.call(this,a,b),h=this,e=function(a){return a.authResponse?h._link(a.authResponse.accessToken,a.authResponse.expiresIn):null!=h._callbacks?h._callbacks.failure(null,h._network,"User cancelled Facebook login or did not fully authorize"):void 0},null!=c.KiiUser.getCurrentUser()?null!=a&&null!=a.access_token?h._link(a.access_token,null):(f=null,null!=a&&null!=a.scope&&(f={scope:a.scope}),g=function(a){return"connected"===a.status?e(a):FB.login(e,f)},FB.getLoginStatus(g)):null!=b?b.failure("A KiiUser must be logged in before linking to Facebook"):void 0},d.prototype._unlinkFromCurrentUser=function(a){return d.__super__._unlinkFromCurrentUser.call(this,a),null!=c.KiiUser.getCurrentUser()?this._unlink():null!=a?a.failure("A KiiUser must be logged in before unlinking from Facebook"):void 0},d}(c.KiiSocialConnectNetwork),c.InvalidDisplayNameException=function(){return this.message="Unable to set displayName. Must be between 4-50 characters."},c.InvalidPasswordException=function(){return this.message="Unable to set password. Must be between 4-50 characters composed with ascii (exclude control character)"},c.InvalidUsernameException=function(){return this.message="Unable to set username. Must be between 3 and 64 characters, which can include alphanumeric characters as well as underscores '_' and periods '.'"},c.InvalidUserIdentifierException=function(){return this.message="User identifier should be one of user name, phone number or email"
},c.InvalidEmailException=function(){return this.message="Unable to set email address. Must be a valid email"},c.InvalidPhoneNumberException=function(){return this.message="Unable to set phone number. Must begin with a '+' and be at least 10 digits"},c.InvalidLocalPhoneNumberException=function(){return this.message="Unable to set phone number. Must be a sequence of numbers"},c.InvalidCountryException=function(){return i.message="Unable to set country code. Must be 2 alphabetic characters. Ex: US, JP, CN"},c.InvalidURIException=function(){return i.message="Unable to set URI. Must be of the form kiicloud://some/path/to/object/or/entity"},c.InvalidACLAction=function(){return i.message="Unable to set ACL action. Must be one of the permitted values in KiiACLAction"},c.InvalidACLSubject=function(){return i.message="Unable to set ACL subject. Must be of type KiiUser or KiiGroup"},c.InvalidACLGrant=function(){return i.message="Unable to set ACL grant. Must be a boolean type"},c.InvalidLimitException=function(){return i.message="Unable to set query limit. Must be an integer > 0"},c.InvalidArgumentException=function(a){return i.message="InvalidArgument: "+a},c.KiiAppAdminContext=function(){function a(a){this._getToken=f(this._getToken,this),this._getId=f(this._getId,this),this._objectWithURI=f(this._objectWithURI,this),this._token=a.token,this._id=a.id}var b,d;return d=null,b=null,a.prototype.bucketWithName=function(a){var b;return b=new c.KiiBucketAdmin(a,null,this._token)},a.prototype.groupWithName=function(a){var b;return b=c.KiiGroupAdmin._groupWithName(a,this)},a.prototype.userWithID=function(a){var b;return b=c.KiiUserAdmin._userWithID(a,this)},a.prototype._userWithLoginName=function(a,b){var d,e,f;return f=new c.KiiUserAdmin(this),e=f._getRequest({path:"/users/LOGIN_NAME:"+a,withApp:!0}),e.setAdminToken(this._token),d={success:function(a,c){if(300>c&&c>=200){if(f._updateWithJSON(a),null!=b)return b.success(f)}else if(null!=b)return b.failure("Unable to parse response")},failure:function(a){return null!=b?b.failure(a):void 0}},e.execute(d,!1)},a.prototype._objectWithURI=function(a){var b,d,e,f,g,h,i,j,k,l;if(i=a.substr("kiicloud://".length),g=i.split("/"),f=g.length,!(f>=4))throw new c.InvalidURIException;return d=4===f?1:3,e=g[d],"groups"===g[0]?h=new c.KiiGroupAdmin._groupWithID(g[1],this._token):"users"===g[0]&&(l=c.KiiUserAdmin._userWithID(g[1],this._token)),k=null,null!=h?k=h:null!=l&&(k=l),b=new c.KiiBucketAdmin(e,k,this._token),j=b.createObject(),j._setUUID(g[f-1]),j},a.prototype._getId=function(){return this._id},a.prototype._getToken=function(){return this._token},a}(),c.KiiACLAdmin=function(a){function b(a,c){this._userWithID=f(this._userWithID,this),this._groupWithID=f(this._groupWithID,this),this._getRequest=f(this._getRequest,this),b.__super__.constructor.call(this),this._setParent(a),this._adminToken=c}var d;return h(b,a),d=null,b.prototype._getRequest=function(a){var c;return c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminToken),c},b.prototype._groupWithID=function(a){var b;return b=c.KiiGroupAdmin._groupWithID(a,this._adminToken)},b.prototype._userWithID=function(a){var b;return b=c.KiiUserAdmin._userWithID(a,this._adminToken)},b}(c.KiiACL),c.KiiGroupAdmin=function(a){function b(a){this._setOwnerFromContext=f(this._setOwnerFromContext,this),this._userWithID=f(this._userWithID,this),this.bucketWithName=f(this.bucketWithName,this),this._getRequest=f(this._getRequest,this),b.__super__.constructor.call(this),this._adminContext=a}var d;return h(b,a),d=null,b.prototype._getRequest=function(a){var c;return c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminContext._getToken()),c},b._groupWithName=function(a,b){return c.KiiGroupAdmin._groupWithNameAndMembers(a,null,b)},b._groupWithNameAndMembers=function(a,b,d){var e;return e=new c.KiiGroupAdmin(d),e._setName(a),e._setAddMembers(b),e},b._groupWithID=function(a,b){var d;return d=new c.KiiGroupAdmin(b),d._setUUID(a),d},b.prototype.bucketWithName=function(a){var b;return b=new c.KiiBucketAdmin(a,this,this._adminContext._getToken())},b.prototype._userWithID=function(a){var b;return b=c.KiiUserAdmin._userWithID(a,this._adminContext._getToken())},b.prototype._setOwnerFromContext=function(){},b}.call(this,c.KiiGroup),c.KiiObjectAdmin=function(a){function b(a){this._userWithID=f(this._userWithID,this),this.objectACL=f(this.objectACL,this),this._getRequest=f(this._getRequest,this),b.__super__.constructor.call(this),this._adminToken=a}var d;return h(b,a),d=null,b.prototype._getRequest=function(a){var d;return c.Kii.logger("admin req: "+this._adminToken),d=b.__super__._getRequest.call(this,a),d.setAdminToken(this._adminToken),d},b.objectWithBucket=function(a,b,d){var e;return c.Kii.logger("Creating object w type: "+b),e=new c.KiiObjectAdmin(d),e._setBucket(a),e._setObjectType(b),c.Kii.logger(e),e},b.prototype.objectACL=function(){var a;return a=new c.KiiACLAdmin(this,this._adminToken)},b.prototype._userWithID=function(a){var b;return b=c.KiiUserAdmin._userWithID(a,this._adminToken)},b}.call(this,c.KiiObject),c.KiiUserAdmin=function(a){function b(a){this.bucketWithName=f(this.bucketWithName,this),this._getRequest=f(this._getRequest,this),b.__super__.constructor.call(this),this._adminContext=a}var d;return h(b,a),d=null,b._userWithID=function(a,b){var d;return d=new c.KiiUserAdmin(b),d._setUUID(a),d},b.prototype._getRequest=function(a){var c;return c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminContext._getToken()),c},b.prototype.bucketWithName=function(a){var b;return b=new c.KiiBucketAdmin(a,this,this._adminContext._getToken())},b}.call(this,c.KiiUser),c.KiiAnonymousUser=function(){function a(){}return a}(),c.KiiAnyAuthenticatedUser=function(){function a(){}return a}(),c.KiiSDKClientInfo=function(){function a(){}var b;return b=null,a.getSDKClientInfo=function(){return null==a._clientInfo&&(a._clientInfo="sn=jss;sv="+c.Kii.getSDKVersion()),a._clientInfo},a}.call(this),c.KiiSCNTwitter=function(b){function d(){this._unlinkFromCurrentUser=f(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=f(this._linkWithCurrentUser,this),this._logOut=f(this._logOut,this),this._logIn=f(this._logIn,this),this._unlink=f(this._unlink,this),this._link=f(this._link,this),this._register=f(this._register,this),this._setup=f(this._setup,this),d.__super__.constructor.call(this,KiiSocialNetworkName.TWITTER)}return h(d,b),d.prototype._setup=function(a,b,c){return this._key=a,this._secret=b,this._extras=c,d.__super__._setup.call(this,this._key,this._secret,this._extras)},d.prototype._register=function(b,d){var e,f,g,h=this;return h=this,g=new a("/integration/twitter",!0),g.setMethod("POST"),e={accessToken:b.oauth_token,accessTokenSecret:b.oauth_token_secret},g.setData(e),g.setAnonymous(!0),g.setContentType("application/vnd.kii.AuthTokenTwitterRequest+json"),f={success:function(a){var e,f;return h._setToken(b.oauth_token),e={oauth_token:b.oauth_token,oauth_token_secret:b.oauth_token_secret},h._setTokenObject(e),f=new c.KiiUser,f._updateWithJSON(a),f._setAccessToken(a.access_token),c.Kii.setCurrentUser(f),null!=d?d.success(c.KiiUser.getCurrentUser(),h._network):void 0},failure:function(a){return null!=d?d.failure(null,h._network,a):void 0}},g.execute(f,!1)},d.prototype._link=function(b,d){var e,f,g,h=this;return h=this,g=new a("/users/me/twitter/link",!0),g.setMethod("POST"),e={accessToken:b.oauth_token,accessTokenSecret:b.oauth_token_secret},g.setData(e),f={success:function(){var a;return h._setToken(b.oauth_token),a={oauth_token:b.oauth_token,oauth_token_secret:b.oauth_token_secret},h._setTokenObject(a),null!=d?d.success(c.KiiUser.getCurrentUser(),h._network):void 0},failure:function(a){return null!=d?d.failure(c.KiiUser.getCurrentUser(),h._network,a):void 0}},g.execute(f,!0)},d.prototype._unlink=function(b){var d,e,f=this;return f=this,d=new a("/users/me/twitter/unlink",!0),d.setMethod("POST"),e={success:function(){return f._setToken(null),f._setTokenObject(null),null!=b?b.success(c.KiiUser.getCurrentUser(),f._network):void 0},failure:function(a){return null!=b?b.failure(c.KiiUser.getCurrentUser(),f._network,a):void 0}},d.execute(e,!0)},d.prototype._logIn=function(a,b){if(d.__super__._logIn.call(this,a,b),i=this,c.Kii.logger("Checking options"),c.Kii.logger(a),null==a||!a.oauth_token&&!a.oauth_token_secret)throw c.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!a.oauth_token)throw c.InvalidArgumentException("options.oauth_token is required");if(!a.oauth_token_secret)throw c.InvalidArgumentException("options.oauth_token_secret is required");return null!=c.KiiUser.getCurrentUser()&&c.KiiUser.logOut(),i._register(a,b)},d.prototype._logOut=function(){return d.__super__._logOut.apply(this,arguments),c.Kii.logger("Log out twitter")},d.prototype._linkWithCurrentUser=function(a,b){if(i=this,null==c.KiiUser.getCurrentUser())return void b.failure(null,i._network,"No user logged in");if(null==a||!a.oauth_token&&!a.oauth_token_secret)throw c.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!a.oauth_token)throw c.InvalidArgumentException("options.oauth_token is required");if(!a.oauth_token_secret)throw c.InvalidArgumentException("options.oauth_token_secret is required");return i._link(a,b)},d.prototype._unlinkFromCurrentUser=function(a){return i=this,null==c.KiiUser.getCurrentUser()?void a.failure(null,i._network,"No user logged in"):this._unlink(a)},d}(c.KiiSocialConnectNetwork),c.KiiGeoPoint=function(){function a(a,b){var d;if(this._latitude=a,this._longitude=b,this._toDict=f(this._toDict,this),this.getLongitude=f(this.getLongitude,this),this.getLatitude=f(this.getLatitude,this),d=function(a,b,c){return c>a&&b>c&&!isNaN(c)},!d(-90,90,a)||!d(-180,180,b))throw c.InvalidArgumentException("Specified latitide or longitude is invalid")}return a.prototype.getLatitude=function(){return this._latitude},a.prototype.getLongitude=function(){return this._longitude},a.geoPoint=function(a,b){return new c.KiiGeoPoint(a,b)},a.prototype._toDict=function(){var a;return a={_type:"point",lat:this._latitude,lon:this._longitude}},a}.call(this),c};!function(){var a="undefined"!=typeof module&&null!==module;a&&module.exports?module.exports={create:function(){return ctor.call(this)}}:ctor()}(),angular.module("enqApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("enqApp").controller("MainCtrl",["$scope",function(a){function b(){var b=f.createObject();b.set("sex",a.sex),b.set("occupation",a.occupation),b.set("votes",a.votes),b.set("opinion",a.opinion),b.save({success:function(a){console.log("object saved"),console.log(a)},failure:function(a,b){console.log("error",a,b)}})}a.votes=[],a.plusfunc=function(){a.votes.push({number:0,p_evaluation:3,s_evaluation:3,impression:""})},a.minusfunc=function(){a.votes.pop()};for(var c=0;4>c;c++)a.plusfunc();Kii.initializeWithSite("4652cd79","ecae25e177620fa0e0d9446756d72045",KiiSite.JP);var d="2014meidai",e="2014meidai";KiiUser.authenticate(d,e,{success:function(a){console.log("User authenticated!"),console.log(a);var b=Kii.getCurrentUser();f=b.bucketWithName("2014meidaiEnq")},failure:function(a,b){console.log("Error authenticating: "+b)}});var f;a.post=b}]);