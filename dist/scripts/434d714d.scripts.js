!function(){var a=function(){var a,b,c,d,e,f,g,h,i=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};return f="undefined"!=typeof exports&&null!==exports?new Object:this,f.KiiSocialNetworkName={FACEBOOK:1,TWITTER:2},f.KiiSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api",SG:"https://api-sg.kii.com/api"},f.Kii=function(){function a(){}var c,e;return e=null,c=null,a.getBuildNumber=function(){return"1"},a.getSDKVersion=function(){return"2.1.13"},a.getBaseURL=function(){return e._baseURL},a.getAppID=function(){return e._appID},a.getAdditionalHeaders=function(){return c},a.setAdditionalHeaders=function(a){return c=a},a.getAppKey=function(){return e._appKey},a.isLogging=function(){return e._logging},a.setLogging=function(a){return e._logging=a,f.Kii.logger("Setting logging: "+a),f.Kii.logger("Base URL: "+e._baseURL)},a.initializeWithSite=function(a,b,c){return e=new g(a,b,c),f.Kii.logger("Initialized "+a+", "+b+", "+c)},a.initialize=function(a,b){return f.Kii.initializeWithSite(a,b,f.KiiSite.US)},a.logger=function(a){return e._logging?console.log(a):void 0},a.bucketWithName=function(a){return new f.KiiBucket._bucketWithName(a,null)},a.groupWithName=function(a){return new f.Kii.groupWithNameAndMembers(a,null)},a.groupWithNameAndMembers=function(a,b){return new f.KiiGroup.groupWithNameAndMembers(a,b)},a.logOut=function(){return e._currentUser=null,f.KiiSocialConnect.logOutAll()},a.loggedIn=function(){return null!=e._currentUser},a.getCurrentUser=function(){var a;return null!=e._currentUser?(a=new f.KiiUser,a._uuid=e._currentUser._uuid,a._username=e._currentUser._username,a._displayName=e._currentUser._displayName,a._password=e._currentUser._password,a._emailAddress=e._currentUser._emailAddress,a._phoneNumber=e._currentUser._phoneNumber,a._country=e._currentUser._country,a._created=e._currentUser._created,a._modified=e._currentUser._modified,a._emailVerified=e._currentUser._emailVerified,a._phoneVerified=e._currentUser._phoneVerified,a._accessToken=e._currentUser._accessToken,a._customInfo=e._currentUser._customInfo,f.Kii.logger("my instance:"),f.Kii.logger(a),a):null},a.setCurrentUser=function(a){return e._currentUser=new f.KiiUser,e._currentUser._uuid=a._uuid,e._currentUser._username=a._username,e._currentUser._displayName=a._displayName,e._currentUser._password=a._password,e._currentUser._emailAddress=a._emailAddress,e._currentUser._phoneNumber=a._phoneNumber,e._currentUser._country=a._country,e._currentUser._created=a._created,e._currentUser._modified=a._modified,e._currentUser._emailVerified=a._emailVerified,e._currentUser._phoneVerified=a._phoneVerified,e._currentUser._accessToken=a._accessToken,e._currentUser._customInfo=a._customInfo,f.Kii.logger("my instance:"),f.Kii.logger(e._currentUser)},a.authenticateAsAppAdmin=function(a,c,d){var e,g;return g=new b("/oauth2/token",!1),g.setAnonymous(!0),g.setMethod("POST"),g.setData({client_id:a,client_secret:c}),e={success:function(){return function(a){var b,c,e;return e=a.access_token,c=a.id,f.Kii.logger("token: "+e),f.Kii.logger("id: "+c),b=new f.KiiAppAdminContext({token:e,id:c}),null!=d?d.success(b):void 0}}(this),failure:function(){return function(a,b){return f.Kii.logger("error: "+a),f.Kii.logger("statusCode: "+b),null!=d?d.failure(a,b):void 0}}(this)},g.execute(e,!1)},a.authenticateAsAdminWithToken=function(a){return new f.KiiAppAdminContext({token:a})},a._setHttpRequestType=function(a){return f.Kii.logger("Set http request as "+a),e._httpRequestType=a},a._getHttpRequestType=function(){return e._httpRequestType},a._getKiiUtilities=function(){return d},a}(),f._KiiHttpRequestType={jQuery:"jQuery",XMLHttpRequest:"XMLHttpRequest",Titanium:"Titanium"},g=function(){function a(a,b,c){this._appKey=b,this._appID=a,this._baseURL=c}return a.prototype._logging=!1,a.prototype._baseURL=null,a.prototype._currentUser=null,a.prototype._httpRequestType=null,a}(),f.KiiACL=function(){function a(){this._userWithID=i(this._userWithID,this),this._groupWithID=i(this._groupWithID,this),this._getRequest=i(this._getRequest,this),this._saveItr=i(this._saveItr,this),this.save=i(this.save,this),this.removeACLEntry=i(this.removeACLEntry,this),this.putACLEntry=i(this.putACLEntry,this),this.listACLEntries=i(this.listACLEntries,this),this.aclPath=i(this.aclPath,this),this._setParent=i(this._setParent,this),this._entries=[]}var c,e,g;return g=null,c=null,e=null,a.prototype._setParent=function(a){this._parent=a},a.prototype.aclPath=function(){var a,b,c,d,e,g,h;return this._parent instanceof f.KiiObject?(d=this._parent,null!=d.getBucket().getUser()?h=d.getBucket().getUser():null!=d.getBucket().getGroup()&&(c=d.getBucket().getGroup()),b=d.getBucket().getBucketName(),e=d.getUUID()):this._parent instanceof f.KiiBucket?(a=this._parent,null!=a.getUser()?h=a.getUser():null!=a.getGroup()&&(c=a.getGroup()),b=a.getBucketName()):f.Kii.logger("Invalid ACL parent. Must belong to a KiiObject"),g="/",null!=c?g+="groups/"+c.getUUID()+"/":null!=h&&(g+="users/"+h.getUUID()+"/"),g+=null!=e?"buckets/"+b+"/objects/"+e+"/acl":"buckets/"+b+"/acl"},a.prototype.listACLEntries=function(a){var b,c;return g=this,f.Kii.logger("Listing ACL entries"),c=this._getRequest({path:this.aclPath(),withApp:!0}),b={success:function(b){return function(c,d){var e,h,i,j,k,l,m,n;if(300>d&&d>=200){j=[];for(i in c)for(l=c[i],"WRITE_EXISTING_OBJECT"===i?e=f.KiiACLAction.KiiACLObjectActionWrite:"READ_EXISTING_OBJECT"===i?e=f.KiiACLAction.KiiACLObjectActionRead:"QUERY_OBJECTS_IN_BUCKET"===i?e=f.KiiACLAction.KiiACLBucketActionQueryObjects:"CREATE_OBJECTS_IN_BUCKET"===i?e=f.KiiACLAction.KiiACLBucketActionCreateObjects:"DROP_BUCKET_WITH_ALL_CONTENT"===i&&(e=f.KiiACLAction.KiiACLBucketActionDropBucket),m=0,n=l.length;n>m;m++)h=l[m],null!=h.groupID?k=b._groupWithID(h.groupID):null!=h.userID&&(k=b._userWithID(h.userID)),j.push(f.KiiACLEntry.entryWithSubject(k,e));return a.success(g,j)}return a.failure(g,"Unable to retrieve ACL list")}}(this),failure:function(){return function(b){return a.failure(g,b)}}(this)},c.execute(b,!1)},a.prototype.putACLEntry=function(a){return-1===this._entries.indexOf(a)?this._entries.push(a):void 0},a.prototype.removeACLEntry=function(a){var b;return b=this._entries.indexOf(a),b>-1?d.arrayRemove(this._entries,b,b):void 0},a.prototype.save=function(a){return f.Kii.logger("SAving acl"),this._saveItr(0,a)},a.prototype._saveItr=function(a,b){var c,d,e,g,h;return h=this,c=this._entries[a],d=""+this.aclPath()+"/"+c.getActionString()+"/"+c.getEntityString(),f.Kii.logger("Saving single @path: "+d),e=this._getRequest({path:d,withApp:!0}),e.setMethod(c.getGrant()===!0?"PUT":"DELETE"),g=null,e.execute({success:function(c){return function(){return a<c._entries.length-1?c._saveItr(a+1,b):b.success(c)}}(this),failure:function(a){return function(c){return b.failure(a,c)}}(this)},!1)},a.aclWithParent=function(a){var b;return b=new f.KiiACL,b._setParent(a),b},a.prototype._getRequest=function(a){var c,d,e;return c=a.path,e=a.withApp,d=new b(c,e)},a.prototype._groupWithID=function(a){var b;return b=f.KiiGroup._groupWithID(a)},a.prototype._userWithID=function(a){var b;return b=f.KiiUser._userWithID(a)},a}(),f.KiiACLAction={KiiACLBucketActionCreateObjects:0,KiiACLBucketActionQueryObjects:1,KiiACLBucketActionDropBucket:2,KiiACLObjectActionRead:3,KiiACLObjectActionWrite:4},f.KiiACLEntry=function(){function a(){this.getEntityString=i(this.getEntityString,this),this.getActionString=i(this.getActionString,this),this.getGrant=i(this.getGrant,this),this.setGrant=i(this.setGrant,this),this.getSubject=i(this.getSubject,this),this.setSubject=i(this.setSubject,this),this.getAction=i(this.getAction,this),this.setAction=i(this.setAction,this),this._action=-1,this._grant=!0}var b,c,d;return b=null,d=null,c=null,a.prototype.setAction=function(a){if(a>=f.KiiACLAction.KiiACLBucketActionCreateObjects&&a<=f.KiiACLAction.KiiACLObjectActionWrite)return this._action=a;throw new InvalidACLAction},a.prototype.getAction=function(){return this._action},a.prototype.setSubject=function(a){if(a instanceof f.KiiGroup||a instanceof f.KiiUser||a instanceof f.KiiAnyAuthenticatedUser||a instanceof f.KiiAnonymousUser)return this._subject=a;throw new f.InvalidACLSubject},a.prototype.getSubject=function(){return this._subject},a.prototype.setGrant=function(a){if(a===!0||a===!1)return this._grant=a;throw new InvalidACLGrant},a.prototype.getGrant=function(){return this._grant},a.entryWithSubject=function(a,b){var c;return f.Kii.logger("EWS: "+a+", "+b),c=new f.KiiACLEntry,c.setSubject(a),c.setAction(b),c},a.prototype.getActionString=function(){var a;switch(f.Kii.logger("Action: "+this.action),this._action){case f.KiiACLAction.KiiACLBucketActionCreateObjects:a="CREATE_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLBucketActionQueryObjects:a="QUERY_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLBucketActionDropBucket:a="DROP_BUCKET_WITH_ALL_CONTENT";break;case f.KiiACLAction.KiiACLObjectActionRead:a="READ_EXISTING_OBJECT";break;case f.KiiACLAction.KiiACLObjectActionWrite:a="WRITE_EXISTING_OBJECT";break;default:return a}return a},a.prototype.getEntityString=function(){var a,b;return this._subject instanceof f.KiiGroup?(a=this._subject.getUUID(),b="GroupID"):this._subject instanceof f.KiiUser?(a=this._subject.getUUID(),b="UserID"):this._subject instanceof f.KiiAnyAuthenticatedUser?(b="UserID",a="ANY_AUTHENTICATED_USER"):this._subject instanceof f.KiiAnonymousUser&&(b="UserID",a="ANONYMOUS_USER"),""+b+":"+a},a}(),f.KiiBucket=function(){function a(a,b){this.objectWithJSON=i(this.objectWithJSON,this),this._generatePath=i(this._generatePath,this),this._getRequest=i(this._getRequest,this),this["delete"]=i(this["delete"],this),this.count=i(this.count,this),this.countWithQuery=i(this.countWithQuery,this),this.executeQuery=i(this.executeQuery,this),this.acl=i(this.acl,this),this.createObjectWithType=i(this.createObjectWithType,this),this.createObject=i(this.createObject,this),this._setBucketName=i(this._setBucketName,this),this.getBucketName=i(this.getBucketName,this),this._setGroup=i(this._setGroup,this),this.getGroup=i(this.getGroup,this),this._setUser=i(this._setUser,this),this.getUser=i(this.getUser,this),this._bucketName=a,null!=b&&(b instanceof f.KiiGroup?this._group=b:b instanceof f.KiiUser&&(this._user=b))}var c,d,e,g;return a.prototype._className="KiiBucket",e=null,c=null,g=null,d=null,a.prototype.getUser=function(){return this._user},a.prototype._setUser=function(a){this._user=a},a.prototype.getGroup=function(){return this._group},a.prototype._setGroup=function(a){this._group=a},a.prototype.getBucketName=function(){return this._bucketName},a.prototype._setBucketName=function(a){this._bucketName=a},a.prototype.createObject=function(){return f.KiiObject.objectWithBucket(this,null)},a.prototype.createObjectWithType=function(a){return f.KiiObject.objectWithBucket(this,a)},a.prototype.acl=function(){return f.KiiACL.aclWithParent(this)},a.prototype.executeQuery=function(a,b){var c,d,g,h;return e=this,g=this._generatePath()+"/query",c={},null!=a?c=a._dictValue():c.bucketQuery={clause:f.KiiQuery._emptyDictValue()},h=this._getRequest({path:g,withApp:!0}),h.setMethod("POST"),h.setContentType("application/vnd.kii.QueryRequest+json"),h.setData(c),d={success:function(){return function(c,d){var f,g,h,i,j,k;if(300>d&&d>=200){for(h=[],k=c.results,i=0,j=k.length;j>i;i++)g=k[i],h.push(e.objectWithJSON(g));if(null!=c.nextPaginationKey&&(f=new KiiQuery(a),f.setPaginationKey(c.nextPaginationKey)),null!=b)return b.success(a,h,f)}else if(null!=b)return b.failure(a,"Unable to parse response")}}(this),failure:function(){return function(a){return null!=b?b.failure(e,a):void 0}}(this)},h.execute(d,!1)},a.prototype.countWithQuery=function(a,b){var c,d,g,h;return e=this,g=this._generatePath()+"/query",c={},null!=a?c=a._dictValue():(c.bucketQuery={clause:f.KiiQuery._emptyDictValue()},a=KiiQuery.queryWithClause()),c.bucketQuery.aggregations=[{type:"COUNT",putAggregationInto:"count_field"}],h=this._getRequest({path:g,withApp:!0}),h.setMethod("POST"),h.setContentType("application/vnd.kii.QueryRequest+json"),h.setData(c),d={success:function(){return function(c,d){var f;if(300>d&&d>=200){if(f=c.aggregations.count_field,null!=b)return b.success(e,a,f)}else if(null!=b)return b.failure(e,a,"Unable to parse response")}}(this),failure:function(){return function(a){return null!=b?b.failure(e,a):void 0}}(this)},h.execute(d,!1)},a.prototype.count=function(a){var b;return b=KiiQuery.queryWithClause(),this.countWithQuery(b,a)},a.prototype["delete"]=function(a){var b,c;return e=this,c=this._getRequest({path:this._generatePath(),withApp:!0}),c.setMethod("DELETE"),b={success:function(){return function(){return null!=a?a.success(e):void 0}}(this),failure:function(){return function(b){return null!=a?a.failure(e,b):void 0}}(this)},c.execute(b,!0)},a._bucketWithName=function(a,b){var c;return c=new f.KiiBucket(a,b)},a.prototype._getRequest=function(a){var c,d,e;return c=a.path,e=a.withApp,d=new b(c,e)},a.prototype._generatePath=function(){var a;return a=null!=this._user?"/users/"+this._user.getUUID()+"/buckets/"+this._bucketName:null!=this._group?"/groups/"+this._group.getUUID()+"/buckets/"+this._bucketName:"/buckets/"+this._bucketName},a.prototype.objectWithJSON=function(a){var b;return b=this.createObject(),b._updateWithJSON(a),b},a}(),f.KiiBucketAdmin=function(a){function b(a,c,d){this.acl=i(this.acl,this),this.createObjectWithType=i(this.createObjectWithType,this),this.createObject=i(this.createObject,this),this._getRequest=i(this._getRequest,this),b.__super__.constructor.call(this,a,c),this._adminToken=d}var c;return k(b,a),c=null,b.prototype._getRequest=function(a){var c;return c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminToken),c},b.prototype.createObject=function(){return f.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},b.prototype.createObjectWithType=function(a){return f.KiiObjectAdmin.objectWithBucket(this,a,this._adminToken)},b.prototype.acl=function(){var a;return a=new f.KiiACLAdmin(this,this._adminToken)},b}(f.KiiBucket),f.KiiGroup=function(){function a(){this._setOwnerFromContext=i(this._setOwnerFromContext,this),this._userWithID=i(this._userWithID,this),this._getRequest=i(this._getRequest,this),this.getOwner=i(this.getOwner,this),this["delete"]=i(this["delete"],this),this.refresh=i(this.refresh,this),this.save=i(this.save,this),this.changeGroupName=i(this.changeGroupName,this),this._saveMembers=i(this._saveMembers,this),this.getMemberList=i(this.getMemberList,this),this._removeMember=i(this._removeMember,this),this._addMember=i(this._addMember,this),this.removeUser=i(this.removeUser,this),this.addUser=i(this.addUser,this),this.bucketWithName=i(this.bucketWithName,this),this.objectURI=i(this.objectURI,this),this._setOwner=i(this._setOwner,this),this.getCachedOwner=i(this.getCachedOwner,this),this._setName=i(this._setName,this),this.getName=i(this.getName,this),this._setUUID=i(this._setUUID,this),this.getUUID=i(this.getUUID,this),this._setAddMembers=i(this._setAddMembers,this),this._getRemoveMembers=i(this._getRemoveMembers,this),this._getAddMembers=i(this._getAddMembers,this),this._addMembers=[],this._removeMembers=[]}var c,e,g,h,j;return j=null,e=null,g=null,c=null,h=null,a.prototype._getAddMembers=function(){return this._addMembers},a.prototype._getRemoveMembers=function(){return this._removeMembers},a.prototype._setAddMembers=function(a){var b,c,d,e;if(null!=a){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this._addMembers.push(b));return e}},a.prototype.getUUID=function(){return this._uuid},a.prototype._setUUID=function(a){this._uuid=a},a.prototype.getName=function(){return this._groupName},a.prototype._setName=function(a){this._groupName=a},a.prototype.getCachedOwner=function(){return this._owner},a.prototype._setOwner=function(a){this._owner=a},a.prototype.objectURI=function(){return null!=this._uuid?"kiicloud://groups/"+this._uuid:null},a.prototype.bucketWithName=function(a){var b;return b=new f.KiiBucket(a,this)},a.prototype.addUser=function(a){var b;return this._addMembers.indexOf(-1===a)&&this._addMembers.push(a),b=this._removeMembers.indexOf(a),b>=0?d.arrayRemove(this._removeMembers,b,b):void 0},a.prototype.removeUser=function(a){var b;return this._removeMembers.indexOf(-1===a)&&this._removeMembers.push(a),b=this._addMembers.indexOf(a),b>=0?d.arrayRemove(this._addMembers,b,b):void 0},a.prototype._addMember=function(a,b){var c,e;return j=this,f.Kii.logger("Adding member "+a.getUUID()+" to group "+this._groupName),e=this._getRequest({path:"/groups/"+this._uuid+"/members/"+a.getUUID(),withApp:!0}),e.setMethod("PUT"),c={success:function(){return function(){var c;return c=j._getAddMembers().indexOf(a),d.arrayRemove(j._getAddMembers(),c,c),b.success(j)}}(this),failure:function(){return function(c){var e;return e=j._getRemoveMembers().indexOf(a),d.arrayRemove(j._getAddMembers(),e,e),b.failure(j,c)}}(this)},e.execute(c,!1)},a.prototype._removeMember=function(a,b){var c,e;return j=this,f.Kii.logger("Removing member "+a.getUUID()+" to group "+this._groupName),e=this._getRequest({path:"/groups/"+this._uuid+"/members/"+a.getUUID(),withApp:!0}),e.setMethod("DELETE"),c={success:function(){return function(){var c;return c=j._getRemoveMembers().indexOf(a),d.arrayRemove(j._getRemoveMembers(),c,c),b.success(j)}}(this),failure:function(){return function(c){var e;return e=j._getRemoveMembers().indexOf(a),d.arrayRemove(j._getRemoveMembers(),e,e),b.failure(j,c)}}(this)},e.execute(c,!1)},a.prototype.getMemberList=function(a){var b,c;return j=this,f.Kii.logger("Getting member list for group "+this._groupName),c=this._getRequest({path:"/groups/"+this._uuid+"/members",withApp:!0}),c.setAccept("application/vnd.kii.MembersRetrievalResponse+json"),b={success:function(b){return function(c,d){var e,f,g,h,i;if(300>d&&d>=200){for(f=[],g=c.members,h=0,i=g.length;i>h;h++)e=g[h],f.push(b._userWithID(e.userID));if(null!=a)return a.success(j,f)}else if(null!=a)return a.failure(j,e,"Unable to get member list of group")}}(this),failure:function(){return function(b){return null!=a?a.failure(j,b):void 0}}(this)},c.execute(b,!1)},a.prototype._saveMembers=function(a){var b,c,d,e,f,g,h;for(j=this,g=this._removeMembers,c=0,e=g.length;e>c;c++)return b=g[c],void this._removeMember(b,a);for(h=this._addMembers,d=0,f=h.length;f>d;d++)return b=h[d],void this._addMember(b,a);return a.success(j)},a.prototype.changeGroupName=function(a,b){var c,d;return j=this,f.Kii.logger("Saving group: "+this.name),null!=this._uuid?(c=this._getRequest({path:"/groups/"+this._uuid+"/name",withApp:!0}),c.setContentType("text/plain"),c.setMethod("PUT"),c.setData(a),d={success:function(){return function(c,d){if(300>d&&d>=200){if(j._setName(a),null!=b)return b.success(j)}else if(null!=b)return b.failure(j,"Unable to change group name - invalid response")}}(this),failure:function(){return function(a){return null!=b?b.failure(j,a):void 0}}(this)},c.execute(d,!0)):b.failure(j,"Invalid group. Save the group on the server before updating the name.")},a.prototype.save=function(a){var b,c,d;return j=this,f.Kii.logger("Saving group: "+this.name),null==this._uuid?(c=this._getRequest({path:"/groups",withApp:!0}),c.setContentType("application/vnd.kii.GroupCreationRequest+json"),c.setMethod("POST"),b={},null!=this._groupName&&(b.name=this._groupName),this._setOwnerFromContext(b),c.setData(b),d={success:function(){return function(b,c){return 300>c&&c>=200?(j._setUUID(b.groupID),j._saveMembers(a)):void 0}}(this),failure:function(){return function(b){return null!=a?a.failure(j,b):void 0}}(this)},c.execute(d,!1)):this._saveMembers(a)},a.prototype.refresh=function(a){var b,c;return j=this,f.Kii.logger("Refreshing group: "+this._groupName),c=new this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),c.setAccept("application/vnd.kii.GroupRetrievalResponse+json"),b={success:function(){return function(b){return j=f.KiiGroup._groupWithJSON(b),null!=a?a.success(j):void 0}}(this),failure:function(){return function(b){return null!=a?a.failure(j,b):void 0}}(this)},c.execute(b,!1)},a.prototype["delete"]=function(a){var b,c;return j=this,f.Kii.logger("Deleting group: "+this._groupName),c=this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),c.setMethod("DELETE"),b={success:function(){return function(b,c){return 300>c&&c>=200&&null!=a?a.success(j):null!=a?a.failure(j,"Unable to parse response"):void 0}}(this),failure:function(){return function(b){return null!=a?a.failure(j,b):void 0}}(this)},c.execute(b,!0)},a.prototype.getOwner=function(a){return j=this,f.Kii.logger("Getting owner of group "+this._groupName),this.refresh({success:function(){return function(b){return null!=a?a.success(b,b.getCachedOwner()):void 0}}(this),failure:function(){return function(b,c){return null!=a?a.failure(b,c):void 0}}(this)})},a.groupWithName=function(a){return f.KiiGroup.groupWithNameAndMembers(a,null)},a.groupWithNameAndMembers=function(a,b){var c;return c=new f.KiiGroup,c._setName(a),c._setAddMembers(b),c},a.groupWithURI=function(a){var b,c,d,e;if(d=null,e=a.substr("kiicloud://".length),c=e.split("/"),b=c.length,!(b>0))throw new f.InvalidURIException;return d=new f.KiiGroup,d._setUUID(c[b-1]),d},a._groupWithID=function(a){var b;return b=new f.KiiGroup,b._setUUID(a),b},a._groupWithJSON=function(a){var b;return b=new f.KiiGroup,null!=a.groupID&&b._setUUID(a.groupID),null!=a.name&&b._setName(a.name),null!=a.owner&&b._setOwner(f.KiiUser._userWithID(a.owner)),b},a.prototype._getRequest=function(a){var c,d,e;return c=a.path,e=a.withApp,d=new b(c,e)},a.prototype._userWithID=function(a){var b;return b=f.KiiUser._userWithID(a)},a.prototype._setOwnerFromContext=function(a){return null!=f.Kii.getCurrentUser()?(this._owner=f.Kii.getCurrentUser(),a.owner=this._owner.getUUID()):void 0},a}(),f.KiiObject=function(){function a(){this.moveBody=i(this.moveBody,this),this._parseObjectUri=i(this._parseObjectUri,this),this._userWithID=i(this._userWithID,this),this._getRequest=i(this._getRequest,this),this["delete"]=i(this["delete"],this),this.refresh=i(this.refresh,this),this.save=i(this.save,this),this.saveAllFields=i(this.saveAllFields,this),this._performSave=i(this._performSave,this),this._updateWithJSON=i(this._updateWithJSON,this),this.objectURI=i(this.objectURI,this),this.objectACL=i(this.objectACL,this),this.getGeoPoint=i(this.getGeoPoint,this),this.setGeoPoint=i(this.setGeoPoint,this),this.get=i(this.get,this),this.set=i(this.set,this),this._getPath=i(this._getPath,this),this._setBucket=i(this._setBucket,this),this.getBucket=i(this.getBucket,this),this._setObjectType=i(this._setObjectType,this),this.getObjectType=i(this.getObjectType,this),this._setModified=i(this._setModified,this),this.getModified=i(this.getModified,this),this._setCreated=i(this._setCreated,this),this.getCreated=i(this.getCreated,this),this._setUUID=i(this._setUUID,this),this.getUUID=i(this.getUUID,this),this._customInfo={}}var c,d,e,g,h,j,k,l;return k=null,a.prototype._alteredFields=[],l=null,d=null,g=null,h=null,e=null,c=null,j=null,a.prototype.getUUID=function(){return this._uuid},a.prototype._setUUID=function(a){this._uuid=a},a.prototype.getCreated=function(){return this._created},a.prototype._setCreated=function(a){this._created=a},a.prototype.getModified=function(){return this._modified},a.prototype._setModified=function(a){this._modified=a},a.prototype.getObjectType=function(){return this._objectType},a.prototype._setObjectType=function(a){this._objectType=a},a.prototype.getBucket=function(){return f.Kii.logger("GEtting bucket "+this._bucket),this._bucket},a.prototype._setBucket=function(a){this._bucket=a},a.prototype._getPath=function(){var a;return a=null!=this._bucket.getUser()?"/users/"+this._bucket.getUser().getUUID()+"/buckets/"+this._bucket.getBucketName()+"/objects/":null!=this._bucket.getGroup()?"/groups/"+this._bucket.getGroup().getUUID()+"/buckets/"+this._bucket.getBucketName()+"/objects/":"/buckets/"+this._bucket.getBucketName()+"/objects/",null!=this._uuid&&(a+=this._uuid),a},a.prototype.set=function(a,b){return this._customInfo[a]=b,this._alteredFields.push(a)},a.prototype.get=function(a){return this._customInfo[a]},a.prototype.setGeoPoint=function(a,b){if(!(b instanceof KiiGeoPoint))throw InvalidArgumentException("Specified kiiGeoPoint is not an instance of KiiGeoPoint");return this._customInfo[a]=b._toDict(),this._alteredFields.push(a)},a.prototype.getGeoPoint=function(a){var b,c,d;return d=this._customInfo[a],b=d.lat,c=d.lon,f.KiiGeoPoint.geoPoint(b,c)},a.prototype.objectACL=function(){return f.KiiACL.aclWithParent(this)},a.prototype.objectURI=function(){var a,b;return a="kiicloud://",null!=this._bucket&&null!=this._uuid&&(b=a,null!=this._bucket.getGroup()?b+="groups/"+this._bucket.getGroup().getUUID()+"/":null!=this._bucket.getUser()&&(b+="users/"+this._bucket.getUser().getUUID()+"/"),b+="buckets/"+this._bucket.getBucketName()+"/objects/"+this._uuid),b},a.prototype._updateWithJSON=function(a){var b,c,d;d=[];for(b in a)c=a[b],"objectID"===b||"_id"===b||"uuid"===b?(f.Kii.logger("Setting uuid: "+c),d.push(this._uuid=c)):d.push("createdAt"===b||"_created"===b||"created"===b?this._created=c:"modifiedAt"===b||"_modified"===b||"modified"===b?this._modified=c:"_owner"===b?this._owner=this._userWithID(c):"_dataType"===b?this._objectType=c:"_calculated"===b?this._customInfo[b]=c:"_"!==b[0]?this._customInfo[b]=c:void 0);return d},a.prototype._performSave=function(a,b){var c,d,e,g,h,i,j,l;if(k=this,e=this._getPath(),g=new this._getRequest({path:e,withApp:!0}),g.setMethod(null!=this._uuid?"PUT":"POST"),c={},a)c=this._customInfo;else for(l=this._alteredFields,i=0,j=l.length;j>i;i++)d=l[i],c[d]=this._customInfo[d];return g.setData(c),null!=this._objectType&&g.setContentType("application/vnd."+f.Kii.getAppID()+"."+this._objectType+"+json"),null==this._uuid||a||(g.addHeader("X-HTTP-Method-Override","PATCH"),g.setMethod("POST")),h={success:function(){return function(a,c){if(300>c&&c>=200){if(k._updateWithJSON(a),k._alteredFields=[],null!=b)return b.success(k)}else if(null!=b)return b.failure(k,"Unable to parse response")}}(this),failure:function(){return function(a){return null!=b?b.failure(k,a):void 0}}(this)},g.execute(h,!1)},a.prototype.saveAllFields=function(a){return this._performSave(!0,a)},a.prototype.save=function(a){return this._performSave(!1,a)},a.prototype.refresh=function(a){var b,c,d;return k=this,b=this._getPath(),d=new this._getRequest({path:b,withApp:!0}),c={success:function(){return function(b,c){if(300>c&&c>=200){if(k._updateWithJSON(b),null!=a)return a.success(k)}else if(null!=a)return a.failure(k,"Unable to parse response")}}(this),failure:function(){return function(b){return null!=a?a.failure(k,b):void 0}}(this)},d.execute(c,!1)},a.prototype["delete"]=function(a){var b,c,d;return k=this,b=this._getPath(),d=new this._getRequest({path:b,withApp:!0}),d.setMethod("DELETE"),c={success:function(){return function(b,c){return 300>c&&c>=200&&null!=a?a.success(k):null!=a?a.failure(k,"Unable to parse response"):void 0}}(this),failure:function(){return function(b){return null!=a?a.failure(k,b):void 0}}(this)},d.execute(c,!0)},a.objectWithBucket=function(a,b){var c;return f.Kii.logger("Creating object w type: "+b),c=new f.KiiObject,c._setBucket(a),c._setObjectType(b),f.Kii.logger(c),c},a.objectWithURI=function(a){var b,c,d,e,g,h,i,j,k,l;if(i=a.substr("kiicloud://".length),g=i.split("/"),e=g.length,f.Kii.logger(g),!(e>=4))throw new f.InvalidURIException;return c=4===e?1:3,d=g[c],"groups"===g[0]?h=new f.KiiGroup._groupWithID(g[1]):"users"===g[0]&&(l=f.KiiUser._userWithID(g[1])),k=null,null!=h?k=h:null!=l&&(k=l),b=new f.KiiBucket._bucketWithName(d,k),f.Kii.logger(b),j=b.createObject(),j._setUUID(g[e-1]),f.Kii.logger(j),j},a.prototype._getRequest=function(a){var c,d,e;return c=a.path,e=a.withApp,d=new b(c,e)},a.prototype._userWithID=function(a){var b;return b=f.KiiUser._userWithID(a)},a.prototype._parseObjectUri=function(a){var b,c,d,e;return d=a.replace(/^kiicloud:\/\//g,"").split("/"),e=d[0],"users"===e?(c={appID:f.Kii.getAppID(),userID:d[1],type:"APP_AND_USER"},b={targetObjectScope:c,targetBucketID:d[3],targetObjectID:d[5]}):"groups"===e?(c={appID:f.Kii.getAppID(),groupID:d[1],type:"APP_AND_GROUP"},b={targetObjectScope:c,targetBucketID:d[3],targetObjectID:d[5]}):(c={appID:f.Kii.getAppID(),type:"APP"},b={targetObjectScope:c,targetBucketID:d[1],targetObjectID:d[3]}),b},a.prototype.moveBody=function(a,b){var c,d,e,g;if(g=this,null==a)throw f.InvalidArgumentException("targetObjectUri is required");if(null==g.getUUID())throw f.InvalidArgumentException("Source object is not saved on the cloud");return d=this._getPath()+"/body/move",e=new this._getRequest({path:d,withApp:!0}),e.setMethod("POST"),e.setContentType("application/vnd.kii.ObjectBodyMoveRequest+json"),e.setData(this._parseObjectUri(a)),c={success:function(){return function(c,d){return 300>d&&d>=200&&null!=b?b.success(g,a):null!=b?b.failure(g,a,"Unable to parse response"):void 0}}(this),failure:function(){return function(c){return null!=b?b.failure(g,a,c):void 0}}(this)},e.execute(c,!0)},a}(),f.KiiQuery=function(){function a(a){return this._dictValue=i(this._dictValue,this),this.sortByAsc=i(this.sortByAsc,this),this.sortByDesc=i(this.sortByDesc,this),this.setLimit=i(this.setLimit,this),this.getLimit=i(this.getLimit,this),this._setClause=i(this._setClause,this),this.setPaginationKey=i(this.setPaginationKey,this),this.getPaginationKey=i(this.getPaginationKey,this),this._clone=i(this._clone,this),this._clone(a)}var b,c,d,e,g,h,j;return j=null,c=null,e=null,g=!1,h=null,d=25,b=null,a.prototype._clone=function(a){var b,c;if(null==a||"object"!=typeof a)return a;c=new a.constructor;for(b in a)c[b]=this._clone(a[b]);return c},a.prototype.getPaginationKey=function(){return this._paginationKey},a.prototype.setPaginationKey=function(a){this._paginationKey=a},a.prototype._setClause=function(a){this._clause=a},a.prototype.getLimit=function(){return this._limit},a.prototype.setLimit=function(a){if(a>0)return this._limit=a;throw new f.InvalidLimitException},a.queryWithClause=function(a){var b;return b=new f.KiiQuery,b._setClause(a),b},a.prototype.sortByDesc=function(a){return this._sortField=a,this._sortDescending=!0},a.prototype.sortByAsc=function(a){return this._sortField=a,this._sortDescending=!1},a._emptyDictValue=function(){return{type:"all"}},a.prototype._dictValue=function(){var a,b;return b={},b.bestEffortLimit=this._limit,null!=this._paginationKey&&(b.paginationKey=this._paginationKey),a={descending:this._sortDescending},a.clause=null!=this._clause?this._clause._getDictValue():f.KiiQuery._emptyDictValue(),null!=this._sortField&&(a.orderBy=this._sortField),b.bucketQuery=a,b},a}(),f.KiiClause=function(){function a(){this._getDictValue=i(this._getDictValue,this),this._setDictValue=i(this._setDictValue,this),this._setWhereClauses=i(this._setWhereClauses,this),this._setWhereType=i(this._setWhereType,this)}var b,c,d;return b=null,d=null,c=null,a.constructor=function(){return a._whereClauses=[],a._dictExpression={}},a.prototype._setWhereType=function(a){this._whereType=a},a.prototype._setWhereClauses=function(a){this._whereClauses=a},a.prototype._setDictValue=function(a){this._dictExpression=a},a.prototype._getDictValue=function(){var a,b,c,d,e,g;if(c={},null!=this._whereClauses&&null!=this._whereType)if(b=[],1===this._whereClauses.length)a=this._whereClauses[0],c="not"===this._whereType?{type:this._whereType,clause:a._getDictValue()}:a._getDictValue();else{for(g=this._whereClauses,d=0,e=g.length;e>d;d++)a=g[d],b.push(a._getDictValue());c={type:this._whereType,clauses:b}}else null!=this._whereClauses?this._whereClauses.length>0&&(c=this._whereClauses[0]._getDictValue()):null!=this._dictExpression&&(c=this._dictExpression);return null==c&&(c=f.KiiQuery.emptyDictValue()),c},a.createWithWhere=function(a,b){var c;
return c=new f.KiiClause,c._setWhereType(a),c._setWhereClauses(b),c},a.create=function(a,b,c){var d,e;return d=new f.KiiClause,e={},"="===a?(e.type="eq",e.field=b,e.value=c):"<"===a?(e.type="range",e.field=b,e.upperLimit=c,e.upperIncluded=!1):"<="===a?(e.type="range",e.field=b,e.upperLimit=c,e.upperIncluded=!0):">"===a?(e.type="range",e.field=b,e.lowerLimit=c,e.lowerIncluded=!1):">="===a?(e.type="range",e.field=b,e.lowerLimit=c,e.lowerIncluded=!0):"in"===a?(e.type="in",e.field=b,e.values=c):"prefix"===a&&(e.type="prefix",e.field=b,e.prefix=c),d._setDictValue(e),d},a.and=function(){return a.createWithWhere("and",arguments)},a.or=function(){return a.createWithWhere("or",arguments)},a.equals=function(a,b){return null!=b._className&&(b=b.objectURI),f.KiiClause.create("=",a,b)},a.notEquals=function(a,b){return null!=b._className&&(b=b.objectURI),f.KiiClause.createWithWhere("not",[f.KiiClause.equals(a,b)])},a.greaterThan=function(a,b){return f.KiiClause.create(">",a,b)},a.greaterThanOrEqual=function(a,b){return f.KiiClause.create(">=",a,b)},a.lessThan=function(a,b){return f.KiiClause.create("<",a,b)},a.lessThanOrEqual=function(a,b){return f.KiiClause.create("<=",a,b)},a["in"]=function(a,b){return f.KiiClause.create("in",a,b)},a.startsWith=function(a,b){return f.KiiClause.create("prefix",a,b)},a.geoDistance=function(a,b,c,d){var e,g,h,i,j;if(h=function(a){return"string"==typeof a&&a.length>0},g=function(a){return null==a?!1:a instanceof KiiGeoPoint},!h(a))throw f.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!g(b))throw f.InvalidArgumentException("center is not a reference of KiiGeoPoint.");if(i="^[a-zA-Z_][a-zA-Z0-9_]*$",null!=d&&!d.match(i))throw f.InvalidArgumentException("putDistanceInto is invalid.");if(0>=c||c>2e7||isNaN(c))throw f.InvalidArgumentException("radius is invalid.");return e=new f.KiiClause,j={},j.type="geodistance",j.field=a,b=b._toDict(),j.center=b,j.radius=c,j.putDistanceInto=d,e._setDictValue(j),e},a.geoBox=function(a,b,c){var d,e,g,h,i,j;if(g=function(a){return"string"==typeof a&&a.length>0},e=function(a){return null==a?!1:a instanceof KiiGeoPoint},!g(a))throw f.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!e(b)||!e(c))throw f.InvalidArgumentException("northEast or southWest is not a reference of KiiGeoPoint.");return d=new f.KiiClause,j={},j.type="geobox",j.field=a,h=b._toDict(),i=c._toDict(),j.box={ne:h,sw:i},d._setDictValue(j),d},a}(),b=function(){function b(a,b){this.execute=i(this.execute,this),this.setAdminToken=i(this.setAdminToken,this),this.addHeader=i(this.addHeader,this),this.setAccept=i(this.setAccept,this),this.getAccept=i(this.getAccept,this),this.setAnonymous=i(this.setAnonymous,this),this.isAnonymous=i(this.isAnonymous,this),this.setContentType=i(this.setContentType,this),this.getContentType=i(this.getContentType,this),this.setData=i(this.setData,this),this.getData=i(this.getData,this),this.setHeaders=i(this.setHeaders,this),this.getHeaders=i(this.getHeaders,this),this.setMethod=i(this.setMethod,this),this.getMethod=i(this.getMethod,this),this.setPath=i(this.setPath,this),this.getPath=i(this.getPath,this),this._path=b?"/apps/"+f.Kii.getAppID()+a:a,this._method="GET",this._headers={accept:"*/*"},this._contentType="application/json",this._anonymous=!1,this._success=function(){return function(){}}(this),this._failure=function(){return function(){}}(this),this._httpRequest=null}var d;return b._path=null,b._method=null,b._headers=null,b._data=null,b._contentType=null,b._anonymous=!1,b._accept=null,b._success=null,b._failure=null,d=null,b.prototype.getPath=function(){return this._path},b.prototype.setPath=function(a){this._path=a},b.prototype.getMethod=function(){return this._method},b.prototype.setMethod=function(a){this._method=a},b.prototype.getHeaders=function(){return this._headers},b.prototype.setHeaders=function(a){this._headers=a},b.prototype.getData=function(){return this._data},b.prototype.setData=function(a){this._data=a},b.prototype.getContentType=function(){return this._contentType},b.prototype.setContentType=function(a){this._contentType=a},b.prototype.isAnonymous=function(){return this._anonymous},b.prototype.setAnonymous=function(a){this._anonymous=a},b.prototype.getAccept=function(){return this._accept},b.prototype.setAccept=function(a){this._accept=a},b.prototype.addHeader=function(a,b){return this._headers[a]=b},b.prototype.setAdminToken=function(a){return this._adminToken=a},b.prototype.execute=function(a,b){var c,d,e,g,h,i,j,k,l,m;this._success=null!=a.success?a.success:this._success,this._failure=null!=a.failure?a.failure:this._failure,this._ignoreBody=b,i=f.Kii.getBaseURL()+this._path,f.Kii.logger("POSTING: "),f.Kii.logger(this._data),null!=this._data&&(h={}),l=this._data;for(e in l)j=l[e],h[e]=encodeURIComponent(j);if(d=JSON.stringify(this._data),f.Kii.logger("Making request["+this._method+"] to "+i+" with data: "+d),c=f.Kii.getAdditionalHeaders(),null!=c)for(g in c)k=c[g],this._headers[g]=k;this._headers["x-kii-appid"]=f.Kii.getAppID(),this._headers["x-kii-appkey"]=f.Kii.getAppKey(),this._headers["x-kii-sdk"]=f.KiiSDKClientInfo.getSDKClientInfo(),null!=this._accept&&(this._headers.accept=this._accept),this._anonymous||null==f.KiiUser.getCurrentUser()||(this._headers.Authorization="Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),null!=this._adminToken&&(this._headers.Authorization="Bearer "+this._adminToken),null!=this._contentType&&(this._headers["Content-Type"]=this._contentType),f.Kii.logger("Headers: "),f.Kii.logger(this._headers),a={onComplete:function(a){return function(){var b,c,d,e,g,h;if(g=a._httpRequest.xhr,4===g.readyState){if(200<=(h=g.status)&&400>h){if(f.Kii.logger("Completed Request["+g.status+"]"),f.Kii.logger(g.responseText),a._ignoreBody)return a._success(null,g.status);try{e=JSON.parse(g.responseText)}catch(i){b=i,e=null}return null!=e?null!=e.errorCode?(c=e.errorCode,null!=e.message&&(c+=": "+e.message),a._failure(c,g.status,e.errorCode)):a._success(e,g.status):a._success(null,g.status,null)}f.Kii.logger("Error loading data..."),c=g.status+" : "+f.Kii.getBaseURL()+a._path;try{e=JSON.parse(decodeURIComponent(g.responseText))}catch(i){d=i,e=null}return null!=e&&null!=e.errorCode&&(c=e.errorCode,null!=e.message&&(c+=": "+e.message)),f.Kii.logger("Failure: "+c),f.Kii.logger(g.responseText),a._failure(c,g.status)}}}(this),onError:function(a){return function(){var b,c,d,e;e=a._httpRequest.xhr,f.Kii.logger("Error loading data..."),b=e.status+" : "+f.Kii.getBaseURL()+a._path;try{d=JSON.parse(decodeURIComponent(e.responseText))}catch(g){c=g,d=null}return null!=d&&null!=d.errorCode&&(b=d.errorCode,null!=d.message&&(b+=": "+d.message)),f.Kii.logger("Failure: "+b),f.Kii.logger(e.responseText),a._failure(b,e.status)}}(this)},this._httpRequest=this._createHttpRequest(this._method,i,a),null==this._httpRequest.xhr&&this._failure("Cross-Origin Resource Sharing is not supported by the browser.",0),m=this._headers;for(e in m)k=m[e],this._httpRequest.xhr.setRequestHeader(e,k);return"GET"!==this._method&&"DELETE"!==this._method?this._httpRequest.xhr.send(d):this._httpRequest.xhr.send()},b.prototype._createHttpRequest=function(b,d,g){var h;return h=null,null===f.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(f.Kii.logger("Use jQuery"),h=new a(b,d,g)):"undefined"!=typeof XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),h=new e(b,d,g)):"undefined"!=typeof Titanium&&(f.Kii.logger("Use Titanium"),h=new c(b,d,g)):(f.Kii.logger("Use http request backdoor"),f.Kii._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.Kii.logger("Use jQuery"),h=new a(b,d,g)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),h=new e(b,d,g)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),h=new c(b,d,g))),h},b}(),f.KiiUser=function(){function a(){this._getRequest=i(this._getRequest,this),this._updateWithJSON=i(this._updateWithJSON,this),this["delete"]=i(this["delete"],this),this.refresh=i(this.refresh,this),this.save=i(this.save,this),this.changeEmail=i(this.changeEmail,this),this.changePhone=i(this.changePhone,this),this.ownerOfGroups=i(this.ownerOfGroups,this),this.memberOfGroups=i(this.memberOfGroups,this),this.resendPhoneNumberVerification=i(this.resendPhoneNumberVerification,this),this.resendEmailVerification=i(this.resendEmailVerification,this),this.resendVerification=i(this.resendVerification,this),this.verifyPhoneNumber=i(this.verifyPhoneNumber,this),this.verifyCredentials=i(this.verifyCredentials,this),this.updatePassword=i(this.updatePassword,this),this.register=i(this.register,this),this._authenticateWithToken=i(this._authenticateWithToken,this),this._authenticate=i(this._authenticate,this),this.bucketWithName=i(this.bucketWithName,this),this.get=i(this.get,this),this.set=i(this.set,this),this.objectURI=i(this.objectURI,this),this._setAccessToken=i(this._setAccessToken,this),this.getAccessToken=i(this.getAccessToken,this),this._setPhoneVerified=i(this._setPhoneVerified,this),this.getPhoneVerified=i(this.getPhoneVerified,this),this._setEmailVerified=i(this._setEmailVerified,this),this.getEmailVerified=i(this.getEmailVerified,this),this._setModified=i(this._setModified,this),this.getModified=i(this.getModified,this),this._setCreated=i(this._setCreated,this),this.getCreated=i(this.getCreated,this),this.setCountry=i(this.setCountry,this),this.getCountry=i(this.getCountry,this),this._setPassword=i(this._setPassword,this),this._setPhoneNumber=i(this._setPhoneNumber,this),this.getPhoneNumber=i(this.getPhoneNumber,this),this._setEmailAddress=i(this._setEmailAddress,this),this.getEmailAddress=i(this.getEmailAddress,this),this._validateDisplayName=i(this._validateDisplayName,this),this.setDisplayName=i(this.setDisplayName,this),this.getDisplayName=i(this.getDisplayName,this),this._setUsername=i(this._setUsername,this),this.getUsername=i(this.getUsername,this),this._setUUID=i(this._setUUID,this),this.getUUID=i(this.getUUID,this),this._customInfo={}}var c,e,g,h,j,k,l,m,n,o,p,q,r,s;return q=null,s=null,r=null,j=null,n=null,k=null,o=null,e=null,g=null,m=null,l=null,p=null,c=null,h=null,a.prototype.getUUID=function(){return this._uuid},a.prototype._setUUID=function(a){this._uuid=a},a.prototype.getUsername=function(){return this._username},a.prototype._setUsername=function(a){var b;if(b=d._trim(a),f.Kii.logger("Setting username: "+b),d._validateUsername(b))return this._username=b;throw new f.InvalidUsernameException},a.prototype.getDisplayName=function(){return this._displayName},a.prototype.setDisplayName=function(a){return this._validateDisplayName(a),this._displayName=a},a.prototype._validateDisplayName=function(a){if(typeof a===!1)throw new f.InvalidDisplayNameException;if(4>a.length||a.length>50)throw new f.InvalidDisplayNameException},a.prototype.getEmailAddress=function(){return this._emailAddress},a.prototype._setEmailAddress=function(a){var b;if(b=d._trim(a),f.Kii.logger("Setting email: "+b),d._validateEmail(b))return this._emailAddress=b;throw new f.InvalidEmailException},a.prototype.getPhoneNumber=function(){return this._phoneNumber},a.prototype._setPhoneNumber=function(a){if(f.Kii.logger("Setting phone number: "+a),d._validatePhoneNumber(a))return this._phoneNumber=a;throw new f.InvalidPhoneNumberException},a.prototype._setPassword=function(a){if(d._validatePassword(a))return this._password=a;throw new f.InvalidPasswordException},a.prototype.getCountry=function(){return this._country},a.prototype.setCountry=function(a){if(d._validateCountryCode(a))return this._country=a;throw new f.InvalidCountryException},a.prototype.getCreated=function(){return this._created},a.prototype._setCreated=function(a){this._created=a},a.prototype.getModified=function(){return this._modified},a.prototype._setModified=function(a){this._modified=a},a.prototype.getEmailVerified=function(){return this._emailVerified},a.prototype._setEmailVerified=function(a){this._emailVerified=a},a.prototype.getPhoneVerified=function(){return this._phoneVerified},a.prototype._setPhoneVerified=function(a){this._phoneVerified=a},a.prototype.getAccessToken=function(){return f.Kii.logger("Getting access token: "+this._accessToken),this._accessToken},a.prototype._setAccessToken=function(a){return this._accessToken=a,f.Kii.logger("Setting access token: "+this._accessToken)},a.prototype.objectURI=function(){var a;return null!=this._uuid&&(a="kiicloud://users/"+this._uuid),a},a.prototype.set=function(a,b){return f.Kii.logger(this),f.Kii.logger(this._customInfo),this._customInfo[a]=b},a.prototype.get=function(a){return this._customInfo[a]},a.getCurrentUser=function(){return f.Kii.getCurrentUser()},a.userWithUsername=function(a,b){var c;return c=new f.KiiUser,c._setUsername(a),c._setPassword(b),c},a._userWithEmailAddress=function(a,b){var c;return c=new f.KiiUser,c._setEmailAddress(a),c._setPassword(b),c},a._userWithPhoneNumber=function(a,b){var c;return c=new f.KiiUser,c._setPhoneNumber(a),c._setPassword(b),c},a.userWithPhoneNumber=function(a,b){var c;return c=new f.KiiUser,c._setPhoneNumber(a),c._setPassword(b),c},a.userWithPhoneNumberAndUsername=function(a,b,c){var d;return d=new f.KiiUser,d._setPhoneNumber(a),d._setUsername(b),d._setPassword(c),d},a.userWithEmailAddress=function(a,b){var c;return c=new f.KiiUser,c._setEmailAddress(a),c._setPassword(b),c},a.userWithEmailAddressAndUsername=function(a,b,c){var d;return d=new f.KiiUser,d._setEmailAddress(a),d._setUsername(b),d._setPassword(c),d},a.userWithEmailAddressAndPhoneNumber=function(a,b,c){var d;return d=new f.KiiUser,d._setEmailAddress(a),d._setPhoneNumber(b),d._setPassword(c),d},a.userWithCredentials=function(a,b,c,d){var e;return e=new f.KiiUser,e._setEmailAddress(a),e._setPhoneNumber(b),e._setUsername(c),e._setPassword(d),e},a._validateURI=function(a){var b,c,e;return a=d._trim(a),c=/^kiicloud:\/\/users\/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})$/i,"string"===(typeof a).toLowerCase()&&(b=a.match(c),null!=b&&(e=b[1])),e},a.userWithURI=function(a){var b,c;if(f.Kii.logger("About to extract from: "+a),c=f.KiiUser._validateURI(a),f.Kii.logger("Extracted uuid from uri: "+c),null==c)throw new f.InvalidURIException;return b=new f.KiiUser,b._setUUID(c),b},a._userWithID=function(a){var b;return b=new f.KiiUser,b._setUUID(a),b},a.prototype.bucketWithName=function(a){return new f.KiiBucket._bucketWithName(a,this)},a.prototype._authenticate=function(a){var b,c,d;return q=this,f.Kii.logger("Authenticating user:"),f.Kii.logger(this),f.Kii.logger("Email verified: "+this._emailVerified),f.Kii.logger("Phone verified: "+this._phoneVerified),null!=this._username?d=this._username:null!=this._emailAddress&&this._emailVerified===!0?d=this._emailAddress:null!=this._phoneNumber&&this._phoneVerified===!0?d=this._phoneNumber:null!=this._emailAddress?d=this._emailAddress:null!=this._phoneNumber&&(d=this._phoneNumber),c=this._getRequest({path:"/oauth2/token",withApp:!1}),c.setAnonymous(!0),c.setMethod("POST"),c.setData({username:d,password:this._password}),b={success:function(){return function(b){return q._setUUID(b.id),q._setAccessToken(b.access_token),f.Kii.setCurrentUser(q),null!=a?a.success(f.Kii.getCurrentUser()):void 0}}(this),failure:function(){return function(b){return null!=a?a.failure(q,b):void 0}}(this)},c.execute(b,!1)},a.prototype._authenticateWithToken=function(a,b){var c,d;return q=this,f.Kii.logger("Authenticating user "+this),f.Kii.logger(b),d=this._getRequest({path:"/users/me",withApp:!0}),d.setAnonymous(!0),d.addHeader("Authorization","Bearer "+a),c={success:function(){return function(c){return q._updateWithJSON(c),q._setAccessToken(a),f.Kii.setCurrentUser(q),null!=b?b.success(f.Kii.getCurrentUser()):void 0}}(this),failure:function(){return function(a){return null!=b?b.failure(q,a):void 0}}(this)},d.execute(c,!1)},a.authenticate=function(a,b,c){var e,g;try{if(f.Kii.logger("UserIdentifier: "+a),!d._validatePassword(b))throw new f.InvalidPasswordException;if(d._validateEmail(a))g=f.KiiUser._userWithEmailAddress(a,b);else if(d._validatePhoneNumber(a))g=f.KiiUser._userWithPhoneNumber(a,b);else{if(!d._validateUsername(a))throw new f.InvalidUserIdentifierException;g=f.KiiUser.userWithUsername(a,b)}return g._authenticate(c)}catch(h){if(e=h,null!=c)return c.failure(null,e.message)}},a.authenticateWithToken=function(a,b){var c;return c=new f.KiiUser,c._authenticateWithToken(a,b)},a.prototype.register=function(a){var b,c,d,e,g,h;q=this,f.Kii.logger("Registering user "+this),b={password:this._password},null!=this._username&&(b.loginName=this._username),null!=this._displayName&&(b.displayName=this._displayName),null!=this._emailAddress&&(b.emailAddress=this._emailAddress),null!=this._phoneNumber&&(b.phoneNumber=this._phoneNumber),null!=this._country&&(b.country=this._country),f.Kii.logger("CINFO"),f.Kii.logger(this._customInfo),h=this._customInfo;for(c in h)g=h[c],f.Kii.logger("Key/val: "+c+"/"+g),b[c]=g;return e=this._getRequest({path:"/users",withApp:!0}),e.setMethod("POST"),e.setData(b),e.setAnonymous(!0),e.setContentType("application/vnd.kii.RegistrationRequest+json"),d={success:function(){return function(b){return f.Kii.logger("Succreg"),q._updateWithJSON(b),q._authenticate(a)}}(this),failure:function(){return function(b){return f.Kii.logger("Failreg"),null!=a?a.failure(q,b):void 0}}(this)},e.execute(d,!1)},a.prototype.updatePassword=function(a,b,c){var e,g,h,i;return q=this,f.Kii.logger("Updating password from "+a+" to "+b),d._validatePassword(b)?(e={oldPassword:a,newPassword:b},g="/users/"+this._uuid+"/password",h=this._getRequest({path:g,withApp:!0}),h.setMethod("PUT"),h.setData(e),h.setContentType("application/vnd.kii.ChangePasswordRequest+json"),i={success:function(){return function(a,d){if(300>d&&d>=200){if(q._setPassword(b),null!=c)return c.success(q)}else if(null!=c)return c.failure(q,"Unable to change password")}}(this),failure:function(){return function(a){return null!=c?c.failure(q,a):void 0}}(this)},h.execute(i,!0)):null!=c?c.failure(q,(new f.InvalidPasswordException).message):void 0},a.resetPassword=function(a,c){var e,g,h,i;if(f.Kii.logger("Resetting password with identifier: "+a),d._validateEmail(a))e="EMAIL";else if(null!=c)return void c.failure("Invalid user identifier. Must be a valid email address");return null!=e?(g="/users/"+e+":"+a+"/password/request-reset",h=new b(g,!0),h.setMethod("POST"),h.setAnonymous(!0),i={success:function(a,b){return 300>b&&b>=200&&null!=c?c.success():null!=c?c.failure("Unable to reset password"):void 0},failure:function(a){return null!=c?c.failure(a):void 0}},h.execute(i,!0)):void 0},a.prototype.verifyCredentials=function(a,b,c){var d,e,g;return q=this,f.Kii.logger("Verifying "+a+" with code: "+b),d="/users/me/"+a+"/verify",e=this._getRequest({path:d,withApp:!0}),e.setMethod("POST"),e.setData({verificationCode:b}),e.setContentType("application/vnd.kii.AddressVerificationRequest+json"),g={success:function(){return function(b,d){if(300>d&&d>=200){if("email-address"===a?q._setEmailVerified(!0):"phone-number"===a&&q._setPhoneVerified(!0),null!=c)return c.success(q)}else if(null!=c)return c.failure(q,"Unable to verify "+a)}}(this),failure:function(){return function(a){return null!=c?c.failure(q,a):void 0}}(this)},e.execute(g,!0)},a.prototype.verifyPhoneNumber=function(a,b){return this.verifyCredentials("phone-number",a,b)},a.prototype.resendVerification=function(a,b){var c,d,e;return q=this,f.Kii.logger("Resending verification "+a),c="/users/me/"+a+"/resend-verification",d=this._getRequest({path:c,withApp:!0}),d.setMethod("POST"),e={success:function(){return function(c,d){return 300>d&&d>=200&&null!=b?b.success(q):null!=b?b.failure(q,"Unable to resend "+a+" verification"):void 0}}(this),failure:function(){return function(a){return null!=b?b.failure(q,a):void 0}}(this)},d.execute(e,!0)},a.prototype.resendEmailVerification=function(a){return this.resendVerification("email-address",a)},a.prototype.resendPhoneNumberVerification=function(a){return this.resendVerification("phone-number",a)},a.prototype.memberOfGroups=function(a){var b,c,d;return q=this,f.Kii.logger("Getting groups for member "+this._uuid),c="/groups/?is_member="+this._uuid,d=this._getRequest({path:c,withApp:!0}),d.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),b={success:function(){return function(b,c){var d,e,g,h,i;if(300>c&&c>=200){for(e=[],i=b.groups,g=0,h=i.length;h>g;g++)d=i[g],e.push(f.KiiGroup._groupWithJSON(d));if(null!=a)return a.success(q,e)}else if(null!=a)return a.failure(q,"Unable to retrieve groups")}}(this),failure:function(){return function(b){return null!=a?a.failure(q,b):void 0}}(this)},d.execute(b,!1)},a.prototype.ownerOfGroups=function(a){var b,c,d;return q=this,f.Kii.logger("Getting groups owned by the user "+this._uuid),c="/groups/?owner="+this._uuid,d=this._getRequest({path:c,withApp:!0}),d.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),b={success:function(){return function(b,c){var d,e,g,h,i;if(300>c&&c>=200){for(e=[],i=b.groups,g=0,h=i.length;h>g;g++)d=i[g],e.push(f.KiiGroup._groupWithJSON(d));if(null!=a)return a.success(q,e)}else if(null!=a)return a.failure(q,"Unable to retrieve groups")}}(this),failure:function(){return function(b){return null!=a?a.failure(q,b):void 0}}(this)},d.execute(b,!1)},a.prototype.changePhone=function(a,b){var c,d,e;return q=this,f.Kii.logger("Updating phone number to "+a),c="/users/"+this._uuid+"/phone-number",d=this._getRequest({path:c,withApp:!0}),d.setMethod("PUT"),d.setContentType("application/vnd.kii.PhoneNumberModificationRequest+json"),d.setData({phoneNumber:a}),e={success:function(){return function(c,d){return 300>d&&d>=200&&null!=b?(q._setPhoneVerified(!1),q._setPhoneNumber(a),b.success(q)):null!=b?b.failure(q,"Unable to update phone number"):void 0}}(this),failure:function(){return function(a){return null!=b?b.failure(q,a):void 0}}(this)},d.execute(e,!0)},a.prototype.changeEmail=function(a,b){var c,e,g;return q=this,f.Kii.logger("Updating email address to: "+a),d._validateEmail(a)?(c="/users/"+this._uuid+"/email-address",e=this._getRequest({path:c,withApp:!0}),e.setMethod("PUT"),e.setContentType("application/vnd.kii.EmailAddressModificationRequest+json"),e.setData({emailAddress:a}),g={success:function(){return function(c,d){return 300>d&&d>=200&&null!=b?(q._setEmailVerified(!1),q._setEmailAddress(a),b.success(q)):null!=b?b.failure(q,"Unable to update email address"):void 0}}(this),failure:function(){return function(a){return null!=b?b.failure(q,a):void 0}}(this)},e.execute(g,!0)):b.failure(q,"Invalid email address format")},a.prototype.save=function(a){var b,c,d,e;return q=this,f.Kii.logger("Saving user: "+this._uuid),c="/users/"+this._uuid,f.Kii.logger("CUSTOMINFO: "),f.Kii.logger(this._customInfo),d=this._getRequest({path:c,withApp:!0}),d.setMethod("POST"),d.setContentType("application/vnd.kii.UserUpdateRequest+json"),b=this._customInfo,null!=this._country&&(b.country=this._country),null!=this._displayName&&(b.displayName=this._displayName),d.setData(b),e={success:function(){return function(b,c){if(300>c&&c>=200){if(q._setModified(b.modifiedAt),null!=a)return a.success(q)}else if(null!=a)return a.failure(q,"Unable to parse response")}}(this),failure:function(){return function(b){return null!=a?a.failure(q,b):void 0}}(this)},d.execute(e,!1)},a.prototype.refresh=function(a){var b,c;return q=this,f.Kii.logger("Refreshing user: "+this._uuid),c=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),b={success:function(){return function(b,c){if(300>c&&c>=200){if(q._updateWithJSON(b),null!=a)return a.success(q)}else if(null!=a)return a.failure(q,"Unable to parse response")}}(this),failure:function(){return function(b){return null!=a?a.failure(q,b):void 0}}(this)},c.execute(b,!1)},a.prototype["delete"]=function(a){var b,c;return f.Kii.logger("Deleting user..."),q=this,c=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),c.setMethod("DELETE"),b={success:function(){return function(b,c){return 300>c&&c>=200&&null!=a?a.success(q):null!=a?a.failure(q,"Unable to parse response"):void 0}}(this),failure:function(){return function(b){return null!=a?a.failure(q,b):void 0}}(this)},c.execute(b,!0)},a.logOut=function(){return f.Kii.logOut()},a.loggedIn=function(){return f.Kii.loggedIn()},a.getCurrentUser=function(){return f.Kii.getCurrentUser()},a.prototype._updateWithJSON=function(a){var b,c,d;f.Kii.logger("Updating with:"),f.Kii.logger(a),d=[];for(b in a)c=a[b],f.Kii.logger("key/val => "+b+"/"+c),f.Kii.logger("Substr "+b.substring(0,1)),"userID"===b||"id"===b?d.push(this._uuid=c):"created"===b||"createdAt"===b||"_created"===b?d.push(this._created=c):"modified"===b||"modifiedAt"===b||"_modified"===b?d.push(this._modified=c):"loginName"===b?d.push(this._username=c):"displayName"===b?d.push(this._displayName=c):"country"===b?(f.Kii.logger("Is setting country"),d.push(this._country=c)):"emailAddress"===b?d.push(this._emailAddress=c):"phoneNumber"===b?d.push(this._phoneNumber=c):"emailAddressVerified"===b?(f.Kii.logger("Email verified: "+c),d.push(this._emailVerified=c)):"phoneNumberVerified"===b?(f.Kii.logger("Phone verified: "+c),d.push(this._phoneVerified=c)):""===b?(f.Kii.logger("Setting empty to custom info"),d.push(this._customInfo[b]=c)):b.substring(0,!0)?(f.Kii.logger("Setting to custom info"),d.push(this._customInfo[b]=c)):d.push(f.Kii.logger("Doing nothing"));return d},a.prototype._getRequest=function(a){var c,d,e;return c=a.path,e=a.withApp,d=new b(c,e)},a}(),d=function(){function a(){}return a.arrayRemove=function(a,b,c){var d;return d=a.slice((c||b)+1||a.length),a.length=0>b?a.length+b:b,a.push.apply(a,d)},a._validateEmail=function(b){var c;return b=a._trim(b),c=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i,"string"!==(typeof b).toLowerCase()?(f.Kii.logger("Not string"),!1):b.match(c)?!0:!1},a._validatePhoneNumber=function(b){var c;return b=a._trim(b),c=/^[\\+]+[0-9]{10,}$/i,"string"!==(typeof b).toLowerCase()?(f.Kii.logger("Not string"),!1):b.match(c)?!0:!1},a._validateLocalPhone=function(b){var c;return b=a._trim(b),c=/^\d+$/,"string"!==(typeof b).toLowerCase()?(f.Kii.logger("Not string"),!1):b.match(c)?!0:(f.Kii.logger("Invalid format"),!1)},a._assertLocalPhoneIsValid=function(b){if(!a._validateLocalPhone(b))throw new f.InvalidLocalPhoneNumberException},a._validateCountryCode=function(b){var c;return b=a._trim(b),c=/^[a-z]{2}$/i,"string"!==(typeof b).toLowerCase()?(f.Kii.logger("Not string"),!1):b.match(c)?(f.Kii.logger("Is true"),!0):!1},a._assertCountryCodeIsValid=function(b){if(!a._validateCountryCode(b))throw new f.InvalidCountryException},a._validatePassword=function(a){var b;return f.Kii.logger("Validating password: "+a),b=/^[\x20-\x7E]{4,50}$/,"string"!==(typeof a).toLowerCase()?(f.Kii.logger("not string"),!1):a.match(b)?(f.Kii.logger("matched"),!0):(f.Kii.logger("other exception"),!1)},a._assertPasswordIsValid=function(b){if(!a._validatePassword(b))throw new f.InvalidPasswordException},a._validateUsername=function(a){var b;return b=/^[a-zA-Z0-9-_\\.]{3,64}$/i,"string"!==(typeof a).toLowerCase()?!1:a.match(b)?!0:!1},a._trim=function(a){var b;return b=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,(a||"").replace(b,"")},a}(),f.KiiSocialConnect=function(){function a(){}var b;return b=null,a.setupNetwork=function(a,c,d,e){var g;return null==b&&(b=new h),g=b._getManager(a),g._reset(),g._setup(c,d,e),f.Kii.logger("Set key: "+g._key)},a.logIn=function(a,c,d){var e;return e=!1,null!=b&&(f.Kii.logger("And manager: "),f.Kii.logger(b._getManager(a)),b._getManager(a)&&(b._getManager(a)._logIn(c,d),e=!0)),f.Kii.logger("Callbacks"),f.Kii.logger(d),e||null==d?void 0:d.failure(f.KiiUser.getCurrentUser(),a,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},a.linkCurrentUserWithNetwork=function(a,c,d){var e;return f.Kii.logger("Trying with instance"),f.Kii.logger(b),e=!1,null!=b&&(f.Kii.logger("And manager: "),f.Kii.logger(b._getManager(a)),b._getManager(a)&&(b._getManager(a)._linkWithCurrentUser(c,d),e=!0)),f.Kii.logger("Callbacks"),f.Kii.logger(d),e||null==d?void 0:d.failure(f.KiiUser.getCurrentUser(),a,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},a.unLinkCurrentUserFromNetwork=function(a,c){if(f.Kii.logger("Trying with instance"),f.Kii.logger(b),null!=b){if(f.Kii.logger("And manager: "),f.Kii.logger(b._getManager(a)),b._getManager(a))return b._getManager(a)._unlinkFromCurrentUser(c)}else if(null!=c)return c.failure(f.KiiUser.getCurrentUser(),a,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},a.getAccessTokenForNetwork=function(a){return b._getManager(a)._getToken()},a.getAccessTokenExpirationForNetwork=function(a){return b._getManager(a)._getTokenExpiration()},a.getAccessTokenObjectForNetwork=function(a){return b._getManager(a)._getTokenObject()},a.logOutAll=function(){var a,c;return null!=b&&(a=b._getManager(f.KiiSocialNetworkName.FACEBOOK),null!=a&&a._logOut(),c=b._getManager(f.KiiSocialNetworkName.TWITTER),null!=c)?c._logOut():void 0},a}(),h=function(){function a(){this._getManager=i(this._getManager,this)}var b,c;return b=null,c=null,a.prototype._getManager=function(a){return a===f.KiiSocialNetworkName.FACEBOOK?null!=this._facebookManager?this._facebookManager:this._facebookManager=new f.KiiSCNFacebook:a===f.KiiSocialNetworkName.TWITTER?null!=this._twitterManager?this._twitterManager:this._twitterManager=new f.KiiSCNTwitter:void 0},a}(),f.KiiSocialConnectNetwork=function(){function a(a){this._network=a,this._setup=i(this._setup,this),this._unlinkFromCurrentUser=i(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=i(this._linkWithCurrentUser,this),this._logOut=i(this._logOut,this),this._logIn=i(this._logIn,this),this._reset=i(this._reset,this),this._isAuthenticated=i(this._isAuthenticated,this),this._getCallbacks=i(this._getCallbacks,this),this._setCallbacks=i(this._setCallbacks,this),this._getTokenObject=i(this._getTokenObject,this),this._setTokenObject=i(this._setTokenObject,this),this._getTokenExpiration=i(this._getTokenExpiration,this),this._setTokenExpiration=i(this._setTokenExpiration,this),this._getToken=i(this._getToken,this),this._setToken=i(this._setToken,this),this._getExtras=i(this._getExtras,this),this._setExtras=i(this._setExtras,this),this._getSecret=i(this._getSecret,this),this._setSecret=i(this._setSecret,this),this._getKey=i(this._getKey,this),this._setKey=i(this._setKey,this),this._getNetwork=i(this._getNetwork,this),this._setNetwork=i(this._setNetwork,this)}var b,c,d,e,f,g,h,j;return a.prototype._className="KiiSocialConnectNetwork",e=null,d=null,f=null,c=null,g=null,h=null,j=null,b=null,a.prototype._setNetwork=function(a){this._network=a},a.prototype._getNetwork=function(){return this._network},a.prototype._setKey=function(a){this._key=a},a.prototype._getKey=function(){return this._key},a.prototype._setSecret=function(a){this._secret=a},a.prototype._getSecret=function(){return this._secret},a.prototype._setExtras=function(a){this._extras=a},a.prototype._getExtras=function(){return this._extras},a.prototype._setToken=function(a){this._token=a},a.prototype._getToken=function(){return this._token},a.prototype._setTokenExpiration=function(a){this._tokenExpiration=a},a.prototype._getTokenExpiration=function(){return this._tokenExpiration},a.prototype._setTokenObject=function(a){this._tokenObject=a},a.prototype._getTokenObject=function(){return this._tokenObject},a.prototype._setCallbacks=function(a){this._callbacks=a},a.prototype._getCallbacks=function(){return this._callbacks},a.prototype._isAuthenticated=function(){return null!=this._tokenObject},a.prototype._reset=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null,this._key=null,this._secret=null,this._extras=null},a.prototype._logIn=function(a,b){this._callbacks=b},a.prototype._logOut=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null},a.prototype._linkWithCurrentUser=function(a,b){this._callbacks=b
},a.prototype._unlinkFromCurrentUser=function(a){this._callbacks=a},a.prototype._setup=function(a,b,c){this._key=a,this._secret=b,this._extras=c},a}(),f.KiiSCNFacebook=function(a){function c(){this._unlinkFromCurrentUser=i(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=i(this._linkWithCurrentUser,this),this._logOut=i(this._logOut,this),this._logIn=i(this._logIn,this),this._unlink=i(this._unlink,this),this._link=i(this._link,this),this._register=i(this._register,this),this._setup=i(this._setup,this),c.__super__.constructor.call(this,KiiSocialNetworkName.FACEBOOK)}var d;return k(c,a),d=null,c.prototype._setup=function(a,b,d){return this._key=a,this._secret=b,this._extras=d,c.__super__._setup.call(this,this._key,this._secret,this._extras),this._extras.appId=this._key,f.Kii.logger(this._extras),FB.init(this._extras)},c.prototype._register=function(a,c){var d,e,g;return g=this,e=new b("/integration/facebook",!0),e.setMethod("POST"),e.setData({accessToken:a}),e.setAnonymous(!0),e.setContentType("application/vnd.kii.AuthTokenFacebookRequest+json"),d={success:function(b){return function(d){var e,g;return b._setToken(a),b._setTokenExpiration(c),e={access_token:a,expires_in:c},b._setTokenObject(e),g=new f.KiiUser,g._updateWithJSON(d),g._setAccessToken(d.access_token),f.Kii.setCurrentUser(g),null!=b._callbacks?b._callbacks.success(f.KiiUser.getCurrentUser(),b._network):void 0}}(this),failure:function(a){return function(b){return null!=a._callbacks?a._callbacks.failure(null,a._network,b):void 0}}(this)},e.execute(d,!1)},c.prototype._link=function(a,c){var d,e,g;return g=this,e=new b("/users/me/facebook/link",!0),e.setMethod("POST"),e.setData({accessToken:a}),d={success:function(b){return function(){var d;return b._setToken(a),b._setTokenExpiration(c),d={access_token:a,expires_in:c},b._setTokenObject(d),null!=b._callbacks?b._callbacks.success(f.KiiUser.getCurrentUser(),b._network):void 0}}(this),failure:function(a){return function(b){return null!=a._callbacks?a._callbacks.failure(f.KiiUser.getCurrentUser(),a._network,b):void 0}}(this)},e.execute(d,!0)},c.prototype._unlink=function(){var a,c,d;return d=this,a=new b("/users/me/facebook/unlink",!0),a.setMethod("POST"),c={success:function(a){return function(){return a._setToken(null),a._setTokenExpiration(null),a._setTokenObject(null),null!=a._callbacks?a._callbacks.success(f.KiiUser.getCurrentUser(),a._network):void 0}}(this),failure:function(a){return function(b){return null!=a._callbacks?a._callbacks.failure(f.KiiUser.getCurrentUser(),a._network,b):void 0}}(this)},a.execute(c,!0)},c.prototype._logIn=function(a,b){var d,e,g,h;return c.__super__._logIn.call(this,a,b),f.Kii.logger("should auth fb"),h=this,f.Kii.logger("Checking options"),f.Kii.logger(a),d=function(a){return function(b){return null!=b.authResponse?(null!=f.KiiUser.getCurrentUser()&&KiiUser.logOut(),a._register(b.authResponse.accessToken,b.authResponse.expiresIn)):null!=a._callbacks?a._callbacks.failure(null,a._network,"User cancelled login or did not fully authorize"):void 0}}(this),null!=a&&null!=a.access_token?(f.Kii.logger("Have options: "),f.Kii.logger(a),null!=f.KiiUser.getCurrentUser()&&KiiUser.logOut(),h._register(a.access_token,null)):(e=null,null!=a&&null!=a.scope&&(e={scope:a.scope}),g=function(a){return"connected"===a.status?d(a):FB.login(d,e)},FB.getLoginStatus(g),g=function(a){return"connected"===a.status?d(a):FB.login(d)},FB.getLoginStatus(g))},c.prototype._logOut=function(){return c.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out fb")},c.prototype._linkWithCurrentUser=function(a,b){var d,e,g,h;return c.__super__._linkWithCurrentUser.call(this,a,b),h=this,d=function(a){return a.authResponse?h._link(a.authResponse.accessToken,a.authResponse.expiresIn):null!=h._callbacks?h._callbacks.failure(null,h._network,"User cancelled Facebook login or did not fully authorize"):void 0},null!=f.KiiUser.getCurrentUser()?null!=a&&null!=a.access_token?h._link(a.access_token,null):(e=null,null!=a&&null!=a.scope&&(e={scope:a.scope}),g=function(a){return"connected"===a.status?d(a):FB.login(d,e)},FB.getLoginStatus(g)):null!=b?b.failure("A KiiUser must be logged in before linking to Facebook"):void 0},c.prototype._unlinkFromCurrentUser=function(a){return c.__super__._unlinkFromCurrentUser.call(this,a),null!=f.KiiUser.getCurrentUser()?this._unlink():null!=a?a.failure("A KiiUser must be logged in before unlinking from Facebook"):void 0},c}(f.KiiSocialConnectNetwork),f.InvalidDisplayNameException=function(){return this.message="Unable to set displayName. Must be between 4-50 characters."},f.InvalidPasswordException=function(){return this.message="Unable to set password. Must be between 4-50 characters composed with ascii (exclude control character)"},f.InvalidUsernameException=function(){return this.message="Unable to set username. Must be between 3 and 64 characters, which can include alphanumeric characters as well as underscores '_' and periods '.'"},f.InvalidUserIdentifierException=function(){return this.message="User identifier should be one of user name, phone number or email"},f.InvalidEmailException=function(){return this.message="Unable to set email address. Must be a valid email"},f.InvalidPhoneNumberException=function(){return this.message="Unable to set phone number. Must begin with a '+' and be at least 10 digits"},f.InvalidLocalPhoneNumberException=function(){return this.message="Unable to set phone number. Must be a sequence of numbers"},f.InvalidCountryException=function(){return this.message="Unable to set country code. Must be 2 alphabetic characters. Ex: US, JP, CN"},f.InvalidURIException=function(){return this.message="Unable to set URI. Must be of the form kiicloud://some/path/to/object/or/entity"},f.InvalidACLAction=function(){return this.message="Unable to set ACL action. Must be one of the permitted values in KiiACLAction"},f.InvalidACLSubject=function(){return this.message="Unable to set ACL subject. Must be of type KiiUser or KiiGroup"},f.InvalidACLGrant=function(){return this.message="Unable to set ACL grant. Must be a boolean type"},f.InvalidLimitException=function(){return this.message="Unable to set query limit. Must be an integer > 0"},f.InvalidArgumentException=function(a){return this.message="InvalidArgument: "+a},f.KiiAppAdminContext=function(){function a(a){this._getToken=i(this._getToken,this),this._getId=i(this._getId,this),this._objectWithURI=i(this._objectWithURI,this),this._token=a.token,this._id=a.id}var b,c;return c=null,b=null,a.prototype.bucketWithName=function(a){var b;return b=new f.KiiBucketAdmin(a,null,this._token)},a.prototype.groupWithName=function(a){var b;return b=f.KiiGroupAdmin._groupWithName(a,this)},a.prototype.userWithID=function(a){var b;return b=f.KiiUserAdmin._userWithID(a,this)},a.prototype.objectWithURI=function(a){var b;return b=this._objectWithURI(a)},a.prototype._userWithLoginName=function(a,b){var c,d,e;return e=new f.KiiUserAdmin(this),d=e._getRequest({path:"/users/LOGIN_NAME:"+a,withApp:!0}),d.setAdminToken(this._token),c={success:function(){return function(a,c){if(300>c&&c>=200){if(e._updateWithJSON(a),null!=b)return b.success(e)}else if(null!=b)return b.failure("Unable to parse response")}}(this),failure:function(){return function(a){return null!=b?b.failure(a):void 0}}(this)},d.execute(c,!1)},a.prototype._objectWithURI=function(a){var b,c,d,e,g,h,i,j,k,l,m;if(!a)throw new f.InvalidURIException;if(m=0===a.indexOf("kiicloud://"),i=a.substr("kiicloud://".length),g=i.split("/"),e=g.length,!(e>=4&&m))throw new f.InvalidURIException;if(c=4===e?1:3,d=g[c],"groups"===g[0]&&6===e)h=new f.KiiGroupAdmin._groupWithID(g[1],this._token);else if("users"===g[0]&&6===e)l=f.KiiUserAdmin._userWithID(g[1],this._token);else if(4!==e)throw new f.InvalidURIException;return k=null,null!=h?k=h:null!=l&&(k=l),b=new f.KiiBucketAdmin(d,k,this._token),j=b.createObject(),j._setUUID(g[e-1]),j},a.prototype._getId=function(){return this._id},a.prototype._getToken=function(){return this._token},a}(),f.KiiACLAdmin=function(a){function b(a,c){this._userWithID=i(this._userWithID,this),this._groupWithID=i(this._groupWithID,this),this._getRequest=i(this._getRequest,this),b.__super__.constructor.call(this),this._setParent(a),this._adminToken=c}var c;return k(b,a),c=null,b.prototype._getRequest=function(a){var c;return c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminToken),c},b.prototype._groupWithID=function(a){var b;return b=f.KiiGroupAdmin._groupWithID(a,this._adminToken)},b.prototype._userWithID=function(a){var b;return b=f.KiiUserAdmin._userWithID(a,this._adminToken)},b}(f.KiiACL),f.KiiGroupAdmin=function(a){function b(a){this._setOwnerFromContext=i(this._setOwnerFromContext,this),this._userWithID=i(this._userWithID,this),this.bucketWithName=i(this.bucketWithName,this),this._getRequest=i(this._getRequest,this),b.__super__.constructor.call(this),this._adminContext=a}var c;return k(b,a),c=null,b.prototype._getRequest=function(a){var c;return c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminContext._getToken()),c},b._groupWithName=function(a,b){return f.KiiGroupAdmin._groupWithNameAndMembers(a,null,b)},b._groupWithNameAndMembers=function(a,b,c){var d;return d=new f.KiiGroupAdmin(c),d._setName(a),d._setAddMembers(b),d},b._groupWithID=function(a,b){var c;return c=new f.KiiGroupAdmin(b),c._setUUID(a),c},b.prototype.bucketWithName=function(a){var b;return b=new f.KiiBucketAdmin(a,this,this._adminContext._getToken())},b.prototype._userWithID=function(a){var b;return b=f.KiiUserAdmin._userWithID(a,this._adminContext._getToken())},b.prototype._setOwnerFromContext=function(){},b}(f.KiiGroup),f.KiiObjectAdmin=function(a){function b(a){this._userWithID=i(this._userWithID,this),this.objectACL=i(this.objectACL,this),this._getRequest=i(this._getRequest,this),b.__super__.constructor.call(this),this._adminToken=a}var c;return k(b,a),c=null,b.prototype._getRequest=function(a){var c;return f.Kii.logger("admin req: "+this._adminToken),c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminToken),c},b.objectWithBucket=function(a,b,c){var d;return f.Kii.logger("Creating object w type: "+b),d=new f.KiiObjectAdmin(c),d._setBucket(a),d._setObjectType(b),f.Kii.logger(d),d},b.prototype.objectACL=function(){var a;return a=new f.KiiACLAdmin(this,this._adminToken)},b.prototype._userWithID=function(a){var b;return b=f.KiiUserAdmin._userWithID(a,this._adminToken)},b}(f.KiiObject),f.KiiUserAdmin=function(a){function b(a){this.bucketWithName=i(this.bucketWithName,this),this._getRequest=i(this._getRequest,this),b.__super__.constructor.call(this),this._adminContext=a}var c;return k(b,a),c=null,b._userWithID=function(a,b){var c;return c=new f.KiiUserAdmin(b),c._setUUID(a),c},b.prototype._getRequest=function(a){var c;return c=b.__super__._getRequest.call(this,a),c.setAdminToken(this._adminContext._getToken()),c},b.prototype.bucketWithName=function(a){var b;return b=new f.KiiBucketAdmin(a,this,this._adminContext._getToken())},b}(f.KiiUser),f.KiiAnonymousUser=function(){function a(){}return a}(),f.KiiAnyAuthenticatedUser=function(){function a(){}return a}(),f.KiiSDKClientInfo=function(){function a(){}var b;return b=null,a.getSDKClientInfo=function(){return null==a._clientInfo&&(a._clientInfo="sn=jss;sv="+f.Kii.getSDKVersion()),a._clientInfo},a}(),f.KiiSCNTwitter=function(a){function c(){this._unlinkFromCurrentUser=i(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=i(this._linkWithCurrentUser,this),this._logOut=i(this._logOut,this),this._logIn=i(this._logIn,this),this._unlink=i(this._unlink,this),this._link=i(this._link,this),this._register=i(this._register,this),this._setup=i(this._setup,this),c.__super__.constructor.call(this,KiiSocialNetworkName.TWITTER)}return k(c,a),c.prototype._setup=function(a,b,d){return this._key=a,this._secret=b,this._extras=d,c.__super__._setup.call(this,this._key,this._secret,this._extras)},c.prototype._register=function(a,c){var d,e,g,h;return h=this,g=new b("/integration/twitter",!0),g.setMethod("POST"),d={accessToken:a.oauth_token,accessTokenSecret:a.oauth_token_secret},g.setData(d),g.setAnonymous(!0),g.setContentType("application/vnd.kii.AuthTokenTwitterRequest+json"),e={success:function(b){return function(d){var e,g;return b._setToken(a.oauth_token),e={oauth_token:a.oauth_token,oauth_token_secret:a.oauth_token_secret},b._setTokenObject(e),g=new f.KiiUser,g._updateWithJSON(d),g._setAccessToken(d.access_token),f.Kii.setCurrentUser(g),null!=c?c.success(f.KiiUser.getCurrentUser(),b._network):void 0}}(this),failure:function(a){return function(b){return null!=c?c.failure(null,a._network,b):void 0}}(this)},g.execute(e,!1)},c.prototype._link=function(a,c){var d,e,g,h;return h=this,g=new b("/users/me/twitter/link",!0),g.setMethod("POST"),d={accessToken:a.oauth_token,accessTokenSecret:a.oauth_token_secret},g.setData(d),e={success:function(b){return function(){var d;return b._setToken(a.oauth_token),d={oauth_token:a.oauth_token,oauth_token_secret:a.oauth_token_secret},b._setTokenObject(d),null!=c?c.success(f.KiiUser.getCurrentUser(),b._network):void 0}}(this),failure:function(a){return function(b){return null!=c?c.failure(f.KiiUser.getCurrentUser(),a._network,b):void 0}}(this)},g.execute(e,!0)},c.prototype._unlink=function(a){var c,d,e;return e=this,c=new b("/users/me/twitter/unlink",!0),c.setMethod("POST"),d={success:function(b){return function(){return b._setToken(null),b._setTokenObject(null),null!=a?a.success(f.KiiUser.getCurrentUser(),b._network):void 0}}(this),failure:function(b){return function(c){return null!=a?a.failure(f.KiiUser.getCurrentUser(),b._network,c):void 0}}(this)},c.execute(d,!0)},c.prototype._logIn=function(a,b){var d;if(c.__super__._logIn.call(this,a,b),d=this,f.Kii.logger("Checking options"),f.Kii.logger(a),null==a||!a.oauth_token&&!a.oauth_token_secret)throw f.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!a.oauth_token)throw f.InvalidArgumentException("options.oauth_token is required");if(!a.oauth_token_secret)throw f.InvalidArgumentException("options.oauth_token_secret is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),d._register(a,b)},c.prototype._logOut=function(){return c.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out twitter")},c.prototype._linkWithCurrentUser=function(a,b){var c;if(c=this,null==f.KiiUser.getCurrentUser())return void b.failure(null,c._network,"No user logged in");if(null==a||!a.oauth_token&&!a.oauth_token_secret)throw f.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!a.oauth_token)throw f.InvalidArgumentException("options.oauth_token is required");if(!a.oauth_token_secret)throw f.InvalidArgumentException("options.oauth_token_secret is required");return c._link(a,b)},c.prototype._unlinkFromCurrentUser=function(a){var b;return b=this,null==f.KiiUser.getCurrentUser()?void a.failure(null,b._network,"No user logged in"):this._unlink(a)},c}(f.KiiSocialConnectNetwork),f.KiiGeoPoint=function(){function a(a,b){var c;if(this._latitude=a,this._longitude=b,this._toDict=i(this._toDict,this),this.getLongitude=i(this.getLongitude,this),this.getLatitude=i(this.getLatitude,this),c=function(a,b,c){return c>a&&b>c&&!isNaN(c)},!c(-90,90,a)||!c(-180,180,b))throw f.InvalidArgumentException("Specified latitide or longitude is invalid")}return a.prototype.getLatitude=function(){return this._latitude},a.prototype.getLongitude=function(){return this._longitude},a.geoPoint=function(a,b){return new f.KiiGeoPoint(a,b)},a.prototype._toDict=function(){var a;return a={_type:"point",lat:this._latitude,lon:this._longitude}},a}(),a=function(){function a(a,b,c){this.xhr=$.ajaxSettings.xhr(),this.xhr.open(a,b,!0),this.xhr.onreadystatechange=c.onComplete}return a.xhr=null,a}(),e=function(){function a(a,b,c){this.xhr=new XMLHttpRequest,"withCredentials"in this.xhr?(this.xhr.open(a,b,!0),this.xhr.onreadystatechange=c.onComplete):this.xhr=null}return a.xhr=null,a}(),c=function(){function a(a,b,c){this.xhr=Ti.Network.createHTTPClient(),this.xhr.open(a,b,!0),this.xhr.onload=c.onComplete,this.xhr.onerror=c.onError}return a.xhr=null,a}(),f};!function(){var b="undefined"!=typeof module&&null!==module;b&&module.exports?module.exports={create:function(){return a.call(this)}}:a()}()}(),angular.module("enqApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/thanks",{templateUrl:"views/thanks.html"}).otherwise({redirectTo:"/"})}]),angular.module("enqApp").controller("MainCtrl",["$scope","Kiicloud",function(a,b){a.votes=[],a.plusfunc=function(){a.votes.push({number:0,p_evaluation:3,s_evaluation:3,impression:""})},a.minusfunc=function(){a.votes.pop()};for(var c=0;4>c;c++)a.plusfunc();a.post=function(){b.post(a)}}]),angular.module("enqApp").service("Kiicloud",["$q",function(a){function b(b){var c=a.defer(),d=KiiClause.equals("type","profile"),e=KiiQuery.queryWithClause(d);return b.countWithQuery(e,{success:function(a,b,d){c.resolve(d)},failure:function(a,b,d){console.log("Execution failed by : "+d),c.reject(-1)}}),c.promise}Kii.initializeWithSite("4652cd79","ecae25e177620fa0e0d9446756d72045",KiiSite.JP);var c,d="2014meidai",e="2014meidai";KiiUser.authenticate(d,e,{success:function(a){console.log("User authenticated!"),console.log(a);var b=Kii.getCurrentUser();c=b.bucketWithName("2014meidaiEnq")},failure:function(a,b){console.log("Error authenticating: "+b)}}),this.post=function(a){b(c).then(function(b){var d=c.createObject();d.set("type","profile"),d.set("id",b),d.set("sex",a.sex),d.set("occupation",a.occupation),d.set("opinion",a.opinion);var e={success:function(a){console.log("object saved"),console.log(a)},failure:function(a,b){console.log("error",a,b)}};d.save(e);angular.forEach(a.votes,function(a){var d=c.createObject();d.set("type","vote"),d.set("profileid",b),d.set("number",a.number),d.set("p_evaluation",a.p_evaluation),d.set("s_evaluation",a.s_evaluation),d.set("impression",a.impression),d.save(e)})})}}]);